{"remainingRequest":"D:\\JavaWebVue\\javaweb-ui\\node_modules\\thread-loader\\dist\\cjs.js!D:\\JavaWebVue\\javaweb-ui\\node_modules\\babel-loader\\lib\\index.js!D:\\JavaWebVue\\javaweb-ui\\node_modules\\element-ui\\lib\\cascader-panel.js","dependencies":[{"path":"D:\\JavaWebVue\\javaweb-ui\\node_modules\\element-ui\\lib\\cascader-panel.js","mtime":499162500000},{"path":"D:\\JavaWebVue\\javaweb-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\JavaWebVue\\javaweb-ui\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\JavaWebVue\\javaweb-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5kZXNjcmlwdGlvbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC50by1zdHJpbmctdGFnIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0Iik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZXZlcnkiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbiIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJlZHVjZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29tZSIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5qc29uLnRvLXN0cmluZy10YWciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5tYXRoLnRvLXN0cmluZy10YWciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIik7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciIpOwoKdmFyIF90eXBlb2YgPSByZXF1aXJlKCJEOi9KYXZhV2ViVnVlL2phdmF3ZWItdWkvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvdHlwZW9mIik7Cgptb2R1bGUuZXhwb3J0cyA9Ci8qKioqKiovCmZ1bmN0aW9uIChtb2R1bGVzKSB7CiAgLy8gd2VicGFja0Jvb3RzdHJhcAoKICAvKioqKioqLwogIC8vIFRoZSBtb2R1bGUgY2FjaGUKCiAgLyoqKioqKi8KICB2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9OwogIC8qKioqKiovCgogIC8qKioqKiovCiAgLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb24KCiAgLyoqKioqKi8KCiAgZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgewogICAgLyoqKioqKi8KCiAgICAvKioqKioqLwogICAgLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlCgogICAgLyoqKioqKi8KICAgIGlmIChpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkgewogICAgICAvKioqKioqLwogICAgICByZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0czsKICAgICAgLyoqKioqKi8KICAgIH0KICAgIC8qKioqKiovCiAgICAvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKQoKICAgIC8qKioqKiovCgoKICAgIHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHsKICAgICAgLyoqKioqKi8KICAgICAgaTogbW9kdWxlSWQsCgogICAgICAvKioqKioqLwogICAgICBsOiBmYWxzZSwKCiAgICAgIC8qKioqKiovCiAgICAgIGV4cG9ydHM6IHt9CiAgICAgIC8qKioqKiovCgogICAgfTsKICAgIC8qKioqKiovCgogICAgLyoqKioqKi8KICAgIC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvbgoKICAgIC8qKioqKiovCgogICAgbW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7CiAgICAvKioqKioqLwoKICAgIC8qKioqKiovCiAgICAvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkCgogICAgLyoqKioqKi8KCiAgICBtb2R1bGUubCA9IHRydWU7CiAgICAvKioqKioqLwoKICAgIC8qKioqKiovCiAgICAvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZQoKICAgIC8qKioqKiovCgogICAgcmV0dXJuIG1vZHVsZS5leHBvcnRzOwogICAgLyoqKioqKi8KICB9CiAgLyoqKioqKi8KCiAgLyoqKioqKi8KCiAgLyoqKioqKi8KICAvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKQoKICAvKioqKioqLwoKCiAgX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlczsKICAvKioqKioqLwoKICAvKioqKioqLwogIC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlCgogIC8qKioqKiovCgogIF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7CiAgLyoqKioqKi8KCiAgLyoqKioqKi8KICAvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHMKCiAgLyoqKioqKi8KCiAgX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24gKGV4cG9ydHMsIG5hbWUsIGdldHRlcikgewogICAgLyoqKioqKi8KICAgIGlmICghX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7CiAgICAgIC8qKioqKiovCiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7CiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBnZXQ6IGdldHRlcgogICAgICB9KTsKICAgICAgLyoqKioqKi8KICAgIH0KICAgIC8qKioqKiovCgogIH07CiAgLyoqKioqKi8KCiAgLyoqKioqKi8KICAvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzCgogIC8qKioqKiovCgoKICBfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbiAoZXhwb3J0cykgewogICAgLyoqKioqKi8KICAgIGlmICh0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHsKICAgICAgLyoqKioqKi8KICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgewogICAgICAgIHZhbHVlOiAnTW9kdWxlJwogICAgICB9KTsKICAgICAgLyoqKioqKi8KICAgIH0KICAgIC8qKioqKiovCgoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgLyoqKioqKi8KICB9OwogIC8qKioqKiovCgogIC8qKioqKiovCiAgLy8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0CgogIC8qKioqKiovCiAgLy8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0CgogIC8qKioqKiovCiAgLy8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zCgogIC8qKioqKiovCiAgLy8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0CgogIC8qKioqKiovCiAgLy8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZQoKICAvKioqKioqLwoKCiAgX193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24gKHZhbHVlLCBtb2RlKSB7CiAgICAvKioqKioqLwogICAgaWYgKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpOwogICAgLyoqKioqKi8KCiAgICBpZiAobW9kZSAmIDgpIHJldHVybiB2YWx1ZTsKICAgIC8qKioqKiovCgogICAgaWYgKG1vZGUgJiA0ICYmIF90eXBlb2YodmFsdWUpID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7CiAgICAvKioqKioqLwoKICAgIHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAvKioqKioqLwoKICAgIF9fd2VicGFja19yZXF1aXJlX18ucihucyk7CiAgICAvKioqKioqLwoKCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgewogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICB2YWx1ZTogdmFsdWUKICAgIH0pOwogICAgLyoqKioqKi8KCiAgICBpZiAobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IgKHZhciBrZXkgaW4gdmFsdWUpIHsKICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICByZXR1cm4gdmFsdWVba2V5XTsKICAgICAgfS5iaW5kKG51bGwsIGtleSkpOwogICAgfQogICAgLyoqKioqKi8KCiAgICByZXR1cm4gbnM7CiAgICAvKioqKioqLwogIH07CiAgLyoqKioqKi8KCiAgLyoqKioqKi8KICAvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlcwoKICAvKioqKioqLwoKCiAgX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24gKG1vZHVsZSkgewogICAgLyoqKioqKi8KICAgIHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgPwogICAgLyoqKioqKi8KICAgIGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7CiAgICAgIHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsKICAgIH0gOgogICAgLyoqKioqKi8KICAgIGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7CiAgICAgIHJldHVybiBtb2R1bGU7CiAgICB9OwogICAgLyoqKioqKi8KCiAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7CiAgICAvKioqKioqLwoKCiAgICByZXR1cm4gZ2V0dGVyOwogICAgLyoqKioqKi8KICB9OwogIC8qKioqKiovCgogIC8qKioqKiovCiAgLy8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsCgogIC8qKioqKiovCgoKICBfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbiAob2JqZWN0LCBwcm9wZXJ0eSkgewogICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsKICB9OwogIC8qKioqKiovCgogIC8qKioqKiovCiAgLy8gX193ZWJwYWNrX3B1YmxpY19wYXRoX18KCiAgLyoqKioqKi8KCgogIF9fd2VicGFja19yZXF1aXJlX18ucCA9ICIvZGlzdC8iOwogIC8qKioqKiovCgogIC8qKioqKiovCgogIC8qKioqKiovCiAgLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzCgogIC8qKioqKiovCgogIHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDU5KTsKICAvKioqKioqLwp9KAovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKLyoqKioqKi8KewogIC8qKiovCiAgMDoKICAvKioqLwogIGZ1bmN0aW9uIF8obW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICAidXNlIHN0cmljdCI7CiAgICAvKiBoYXJtb255IGV4cG9ydCAoYmluZGluZykgKi8KCiAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgImEiLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBub3JtYWxpemVDb21wb25lbnQ7CiAgICB9KTsKICAgIC8qIGdsb2JhbHMgX19WVUVfU1NSX0NPTlRFWFRfXyAqLwogICAgLy8gSU1QT1JUQU5UOiBEbyBOT1QgdXNlIEVTMjAxNSBmZWF0dXJlcyBpbiB0aGlzIGZpbGUgKGV4Y2VwdCBmb3IgbW9kdWxlcykuCiAgICAvLyBUaGlzIG1vZHVsZSBpcyBhIHJ1bnRpbWUgdXRpbGl0eSBmb3IgY2xlYW5lciBjb21wb25lbnQgbW9kdWxlIG91dHB1dCBhbmQgd2lsbAogICAgLy8gYmUgaW5jbHVkZWQgaW4gdGhlIGZpbmFsIHdlYnBhY2sgdXNlciBidW5kbGUuCgoKICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZUNvbXBvbmVudChzY3JpcHRFeHBvcnRzLCByZW5kZXIsIHN0YXRpY1JlbmRlckZucywgZnVuY3Rpb25hbFRlbXBsYXRlLCBpbmplY3RTdHlsZXMsIHNjb3BlSWQsIG1vZHVsZUlkZW50aWZpZXIsCiAgICAvKiBzZXJ2ZXIgb25seSAqLwogICAgc2hhZG93TW9kZQogICAgLyogdnVlLWNsaSBvbmx5ICovCiAgICApIHsKICAgICAgLy8gVnVlLmV4dGVuZCBjb25zdHJ1Y3RvciBleHBvcnQgaW50ZXJvcAogICAgICB2YXIgb3B0aW9ucyA9IHR5cGVvZiBzY3JpcHRFeHBvcnRzID09PSAnZnVuY3Rpb24nID8gc2NyaXB0RXhwb3J0cy5vcHRpb25zIDogc2NyaXB0RXhwb3J0czsgLy8gcmVuZGVyIGZ1bmN0aW9ucwoKICAgICAgaWYgKHJlbmRlcikgewogICAgICAgIG9wdGlvbnMucmVuZGVyID0gcmVuZGVyOwogICAgICAgIG9wdGlvbnMuc3RhdGljUmVuZGVyRm5zID0gc3RhdGljUmVuZGVyRm5zOwogICAgICAgIG9wdGlvbnMuX2NvbXBpbGVkID0gdHJ1ZTsKICAgICAgfSAvLyBmdW5jdGlvbmFsIHRlbXBsYXRlCgoKICAgICAgaWYgKGZ1bmN0aW9uYWxUZW1wbGF0ZSkgewogICAgICAgIG9wdGlvbnMuZnVuY3Rpb25hbCA9IHRydWU7CiAgICAgIH0gLy8gc2NvcGVkSWQKCgogICAgICBpZiAoc2NvcGVJZCkgewogICAgICAgIG9wdGlvbnMuX3Njb3BlSWQgPSAnZGF0YS12LScgKyBzY29wZUlkOwogICAgICB9CgogICAgICB2YXIgaG9vazsKCiAgICAgIGlmIChtb2R1bGVJZGVudGlmaWVyKSB7CiAgICAgICAgLy8gc2VydmVyIGJ1aWxkCiAgICAgICAgaG9vayA9IGZ1bmN0aW9uIGhvb2soY29udGV4dCkgewogICAgICAgICAgLy8gMi4zIGluamVjdGlvbgogICAgICAgICAgY29udGV4dCA9IGNvbnRleHQgfHwgLy8gY2FjaGVkIGNhbGwKICAgICAgICAgIHRoaXMuJHZub2RlICYmIHRoaXMuJHZub2RlLnNzckNvbnRleHQgfHwgLy8gc3RhdGVmdWwKICAgICAgICAgIHRoaXMucGFyZW50ICYmIHRoaXMucGFyZW50LiR2bm9kZSAmJiB0aGlzLnBhcmVudC4kdm5vZGUuc3NyQ29udGV4dDsgLy8gZnVuY3Rpb25hbAogICAgICAgICAgLy8gMi4yIHdpdGggcnVuSW5OZXdDb250ZXh0OiB0cnVlCgogICAgICAgICAgaWYgKCFjb250ZXh0ICYmIHR5cGVvZiBfX1ZVRV9TU1JfQ09OVEVYVF9fICE9PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICBjb250ZXh0ID0gX19WVUVfU1NSX0NPTlRFWFRfXzsKICAgICAgICAgIH0gLy8gaW5qZWN0IGNvbXBvbmVudCBzdHlsZXMKCgogICAgICAgICAgaWYgKGluamVjdFN0eWxlcykgewogICAgICAgICAgICBpbmplY3RTdHlsZXMuY2FsbCh0aGlzLCBjb250ZXh0KTsKICAgICAgICAgIH0gLy8gcmVnaXN0ZXIgY29tcG9uZW50IG1vZHVsZSBpZGVudGlmaWVyIGZvciBhc3luYyBjaHVuayBpbmZlcnJlbmNlCgoKICAgICAgICAgIGlmIChjb250ZXh0ICYmIGNvbnRleHQuX3JlZ2lzdGVyZWRDb21wb25lbnRzKSB7CiAgICAgICAgICAgIGNvbnRleHQuX3JlZ2lzdGVyZWRDb21wb25lbnRzLmFkZChtb2R1bGVJZGVudGlmaWVyKTsKICAgICAgICAgIH0KICAgICAgICB9OyAvLyB1c2VkIGJ5IHNzciBpbiBjYXNlIGNvbXBvbmVudCBpcyBjYWNoZWQgYW5kIGJlZm9yZUNyZWF0ZQogICAgICAgIC8vIG5ldmVyIGdldHMgY2FsbGVkCgoKICAgICAgICBvcHRpb25zLl9zc3JSZWdpc3RlciA9IGhvb2s7CiAgICAgIH0gZWxzZSBpZiAoaW5qZWN0U3R5bGVzKSB7CiAgICAgICAgaG9vayA9IHNoYWRvd01vZGUgPyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpbmplY3RTdHlsZXMuY2FsbCh0aGlzLCB0aGlzLiRyb290LiRvcHRpb25zLnNoYWRvd1Jvb3QpOwogICAgICAgIH0gOiBpbmplY3RTdHlsZXM7CiAgICAgIH0KCiAgICAgIGlmIChob29rKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuZnVuY3Rpb25hbCkgewogICAgICAgICAgLy8gZm9yIHRlbXBsYXRlLW9ubHkgaG90LXJlbG9hZCBiZWNhdXNlIGluIHRoYXQgY2FzZSB0aGUgcmVuZGVyIGZuIGRvZXNuJ3QKICAgICAgICAgIC8vIGdvIHRocm91Z2ggdGhlIG5vcm1hbGl6ZXIKICAgICAgICAgIG9wdGlvbnMuX2luamVjdFN0eWxlcyA9IGhvb2s7IC8vIHJlZ2lzdGVyIGZvciBmdW5jdGlvYWwgY29tcG9uZW50IGluIHZ1ZSBmaWxlCgogICAgICAgICAgdmFyIG9yaWdpbmFsUmVuZGVyID0gb3B0aW9ucy5yZW5kZXI7CgogICAgICAgICAgb3B0aW9ucy5yZW5kZXIgPSBmdW5jdGlvbiByZW5kZXJXaXRoU3R5bGVJbmplY3Rpb24oaCwgY29udGV4dCkgewogICAgICAgICAgICBob29rLmNhbGwoY29udGV4dCk7CiAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbFJlbmRlcihoLCBjb250ZXh0KTsKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGluamVjdCBjb21wb25lbnQgcmVnaXN0cmF0aW9uIGFzIGJlZm9yZUNyZWF0ZSBob29rCiAgICAgICAgICB2YXIgZXhpc3RpbmcgPSBvcHRpb25zLmJlZm9yZUNyZWF0ZTsKICAgICAgICAgIG9wdGlvbnMuYmVmb3JlQ3JlYXRlID0gZXhpc3RpbmcgPyBbXS5jb25jYXQoZXhpc3RpbmcsIGhvb2spIDogW2hvb2tdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBleHBvcnRzOiBzY3JpcHRFeHBvcnRzLAogICAgICAgIG9wdGlvbnM6IG9wdGlvbnMKICAgICAgfTsKICAgIH0KICAgIC8qKiovCgogIH0sCgogIC8qKiovCiAgMTU6CiAgLyoqKi8KICBmdW5jdGlvbiBfKG1vZHVsZSwgZXhwb3J0cykgewogICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJlbGVtZW50LXVpL2xpYi9zY3JvbGxiYXIiKTsKICAgIC8qKiovCiAgfSwKCiAgLyoqKi8KICAxODoKICAvKioqLwogIGZ1bmN0aW9uIF8obW9kdWxlLCBleHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImVsZW1lbnQtdWkvbGliL2NoZWNrYm94Iik7CiAgICAvKioqLwogIH0sCgogIC8qKiovCiAgMjE6CiAgLyoqKi8KICBmdW5jdGlvbiBfKG1vZHVsZSwgZXhwb3J0cykgewogICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJlbGVtZW50LXVpL2xpYi91dGlscy9zaGFyZWQiKTsKICAgIC8qKiovCiAgfSwKCiAgLyoqKi8KICAyNjoKICAvKioqLwogIGZ1bmN0aW9uIF8obW9kdWxlLCBleHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImJhYmVsLWhlbHBlci12dWUtanN4LW1lcmdlLXByb3BzIik7CiAgICAvKioqLwogIH0sCgogIC8qKiovCiAgMzoKICAvKioqLwogIGZ1bmN0aW9uIF8obW9kdWxlLCBleHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImVsZW1lbnQtdWkvbGliL3V0aWxzL3V0aWwiKTsKICAgIC8qKiovCiAgfSwKCiAgLyoqKi8KICAzMToKICAvKioqLwogIGZ1bmN0aW9uIF8obW9kdWxlLCBleHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImVsZW1lbnQtdWkvbGliL3V0aWxzL3Njcm9sbC1pbnRvLXZpZXciKTsKICAgIC8qKiovCiAgfSwKCiAgLyoqKi8KICA0MDoKICAvKioqLwogIGZ1bmN0aW9uIF8obW9kdWxlLCBleHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImVsZW1lbnQtdWkvbGliL3V0aWxzL2FyaWEtdXRpbHMiKTsKICAgIC8qKiovCiAgfSwKCiAgLyoqKi8KICA1MToKICAvKioqLwogIGZ1bmN0aW9uIF8obW9kdWxlLCBleHBvcnRzKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoImVsZW1lbnQtdWkvbGliL3JhZGlvIik7CiAgICAvKioqLwogIH0sCgogIC8qKiovCiAgNTk6CiAgLyoqKi8KICBmdW5jdGlvbiBfKG1vZHVsZSwgX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgInVzZSBzdHJpY3QiOwoKICAgIF9fd2VicGFja19yZXF1aXJlX18ucihfX3dlYnBhY2tfZXhwb3J0c19fKTsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvdnVlLWxvYWRlci9saWIvbG9hZGVycy90ZW1wbGF0ZUxvYWRlci5qcz8/dnVlLWxvYWRlci1vcHRpb25zIS4vbm9kZV9tb2R1bGVzL3Z1ZS1sb2FkZXIvbGliPz92dWUtbG9hZGVyLW9wdGlvbnMhLi9wYWNrYWdlcy9jYXNjYWRlci1wYW5lbC9zcmMvY2FzY2FkZXItcGFuZWwudnVlP3Z1ZSZ0eXBlPXRlbXBsYXRlJmlkPTM0OTMyMzQ2JgoKCiAgICB2YXIgY2FzY2FkZXJfcGFuZWx2dWVfdHlwZV90ZW1wbGF0ZV9pZF8zNDkzMjM0Nl9yZW5kZXIgPSBmdW5jdGlvbiBjYXNjYWRlcl9wYW5lbHZ1ZV90eXBlX3RlbXBsYXRlX2lkXzM0OTMyMzQ2X3JlbmRlcigpIHsKICAgICAgdmFyIF92bSA9IHRoaXM7CgogICAgICB2YXIgX2ggPSBfdm0uJGNyZWF0ZUVsZW1lbnQ7CgogICAgICB2YXIgX2MgPSBfdm0uX3NlbGYuX2MgfHwgX2g7CgogICAgICByZXR1cm4gX2MoImRpdiIsIHsKICAgICAgICBjbGFzczogWyJlbC1jYXNjYWRlci1wYW5lbCIsIF92bS5ib3JkZXIgJiYgImlzLWJvcmRlcmVkIl0sCiAgICAgICAgb246IHsKICAgICAgICAgIGtleWRvd246IF92bS5oYW5kbGVLZXlEb3duCiAgICAgICAgfQogICAgICB9LCBfdm0uX2woX3ZtLm1lbnVzLCBmdW5jdGlvbiAobWVudSwgaW5kZXgpIHsKICAgICAgICByZXR1cm4gX2MoImNhc2NhZGVyLW1lbnUiLCB7CiAgICAgICAgICBrZXk6IGluZGV4LAogICAgICAgICAgcmVmOiAibWVudSIsCiAgICAgICAgICByZWZJbkZvcjogdHJ1ZSwKICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgIGluZGV4OiBpbmRleCwKICAgICAgICAgICAgbm9kZXM6IG1lbnUKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSksIDEpOwogICAgfTsKCiAgICB2YXIgc3RhdGljUmVuZGVyRm5zID0gW107CiAgICBjYXNjYWRlcl9wYW5lbHZ1ZV90eXBlX3RlbXBsYXRlX2lkXzM0OTMyMzQ2X3JlbmRlci5fd2l0aFN0cmlwcGVkID0gdHJ1ZTsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9wYWNrYWdlcy9jYXNjYWRlci1wYW5lbC9zcmMvY2FzY2FkZXItcGFuZWwudnVlP3Z1ZSZ0eXBlPXRlbXBsYXRlJmlkPTM0OTMyMzQ2JgogICAgLy8gRVhURVJOQUwgTU9EVUxFOiBleHRlcm5hbCAiYmFiZWwtaGVscGVyLXZ1ZS1qc3gtbWVyZ2UtcHJvcHMiCgogICAgdmFyIGV4dGVybmFsX2JhYmVsX2hlbHBlcl92dWVfanN4X21lcmdlX3Byb3BzXyA9IF9fd2VicGFja19yZXF1aXJlX18oMjYpOwoKICAgIHZhciBleHRlcm5hbF9iYWJlbF9oZWxwZXJfdnVlX2pzeF9tZXJnZV9wcm9wc19kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihleHRlcm5hbF9iYWJlbF9oZWxwZXJfdnVlX2pzeF9tZXJnZV9wcm9wc18pOyAvLyBFWFRFUk5BTCBNT0RVTEU6IGV4dGVybmFsICJlbGVtZW50LXVpL2xpYi9zY3JvbGxiYXIiCgoKICAgIHZhciBzY3JvbGxiYXJfID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNSk7CgogICAgdmFyIHNjcm9sbGJhcl9kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihzY3JvbGxiYXJfKTsgLy8gRVhURVJOQUwgTU9EVUxFOiBleHRlcm5hbCAiZWxlbWVudC11aS9saWIvY2hlY2tib3giCgoKICAgIHZhciBjaGVja2JveF8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE4KTsKCiAgICB2YXIgY2hlY2tib3hfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4oY2hlY2tib3hfKTsgLy8gRVhURVJOQUwgTU9EVUxFOiBleHRlcm5hbCAiZWxlbWVudC11aS9saWIvcmFkaW8iCgoKICAgIHZhciByYWRpb18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxKTsKCiAgICB2YXIgcmFkaW9fZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4ocmFkaW9fKTsgLy8gRVhURVJOQUwgTU9EVUxFOiBleHRlcm5hbCAiZWxlbWVudC11aS9saWIvdXRpbHMvdXRpbCIKCgogICAgdmFyIHV0aWxfID0gX193ZWJwYWNrX3JlcXVpcmVfXygzKTsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvYmFiZWwtbG9hZGVyL2xpYiEuL25vZGVfbW9kdWxlcy92dWUtbG9hZGVyL2xpYj8/dnVlLWxvYWRlci1vcHRpb25zIS4vcGFja2FnZXMvY2FzY2FkZXItcGFuZWwvc3JjL2Nhc2NhZGVyLW5vZGUudnVlP3Z1ZSZ0eXBlPXNjcmlwdCZsYW5nPWpzJgoKCiAgICB2YXIgc3RvcFByb3BhZ2F0aW9uID0gZnVuY3Rpb24gc3RvcFByb3BhZ2F0aW9uKGUpIHsKICAgICAgcmV0dXJuIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICB9OwogICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLwoKCiAgICB2YXIgY2FzY2FkZXJfbm9kZXZ1ZV90eXBlX3NjcmlwdF9sYW5nX2pzXyA9IHsKICAgICAgaW5qZWN0OiBbJ3BhbmVsJ10sCiAgICAgIGNvbXBvbmVudHM6IHsKICAgICAgICBFbENoZWNrYm94OiBjaGVja2JveF9kZWZhdWx0LmEsCiAgICAgICAgRWxSYWRpbzogcmFkaW9fZGVmYXVsdC5hCiAgICAgIH0sCiAgICAgIHByb3BzOiB7CiAgICAgICAgbm9kZTogewogICAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICB9LAogICAgICAgIG5vZGVJZDogU3RyaW5nCiAgICAgIH0sCiAgICAgIGNvbXB1dGVkOiB7CiAgICAgICAgY29uZmlnOiBmdW5jdGlvbiBjb25maWcoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5wYW5lbC5jb25maWc7CiAgICAgICAgfSwKICAgICAgICBpc0xlYWY6IGZ1bmN0aW9uIGlzTGVhZigpIHsKICAgICAgICAgIHJldHVybiB0aGlzLm5vZGUuaXNMZWFmOwogICAgICAgIH0sCiAgICAgICAgaXNEaXNhYmxlZDogZnVuY3Rpb24gaXNEaXNhYmxlZCgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLm5vZGUuaXNEaXNhYmxlZDsKICAgICAgICB9LAogICAgICAgIGNoZWNrZWRWYWx1ZTogZnVuY3Rpb24gY2hlY2tlZFZhbHVlKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMucGFuZWwuY2hlY2tlZFZhbHVlOwogICAgICAgIH0sCiAgICAgICAgaXNDaGVja2VkOiBmdW5jdGlvbiBpc0NoZWNrZWQoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5ub2RlLmlzU2FtZU5vZGUodGhpcy5jaGVja2VkVmFsdWUpOwogICAgICAgIH0sCiAgICAgICAgaW5BY3RpdmVQYXRoOiBmdW5jdGlvbiBpbkFjdGl2ZVBhdGgoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5pc0luUGF0aCh0aGlzLnBhbmVsLmFjdGl2ZVBhdGgpOwogICAgICAgIH0sCiAgICAgICAgaW5DaGVja2VkUGF0aDogZnVuY3Rpb24gaW5DaGVja2VkUGF0aCgpIHsKICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgICAgaWYgKCF0aGlzLmNvbmZpZy5jaGVja1N0cmljdGx5KSByZXR1cm4gZmFsc2U7CiAgICAgICAgICByZXR1cm4gdGhpcy5wYW5lbC5jaGVja2VkTm9kZVBhdGhzLnNvbWUoZnVuY3Rpb24gKGNoZWNrZWRQYXRoKSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpcy5pc0luUGF0aChjaGVja2VkUGF0aCk7CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZSgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLm5vZGUuZ2V0VmFsdWVCeU9wdGlvbigpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbWV0aG9kczogewogICAgICAgIGhhbmRsZUV4cGFuZDogZnVuY3Rpb24gaGFuZGxlRXhwYW5kKCkgewogICAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgICAgdmFyIHBhbmVsID0gdGhpcy5wYW5lbCwKICAgICAgICAgICAgICBub2RlID0gdGhpcy5ub2RlLAogICAgICAgICAgICAgIGlzRGlzYWJsZWQgPSB0aGlzLmlzRGlzYWJsZWQsCiAgICAgICAgICAgICAgY29uZmlnID0gdGhpcy5jb25maWc7CiAgICAgICAgICB2YXIgbXVsdGlwbGUgPSBjb25maWcubXVsdGlwbGUsCiAgICAgICAgICAgICAgY2hlY2tTdHJpY3RseSA9IGNvbmZpZy5jaGVja1N0cmljdGx5OwogICAgICAgICAgaWYgKCFjaGVja1N0cmljdGx5ICYmIGlzRGlzYWJsZWQgfHwgbm9kZS5sb2FkaW5nKSByZXR1cm47CgogICAgICAgICAgaWYgKGNvbmZpZy5sYXp5ICYmICFub2RlLmxvYWRlZCkgewogICAgICAgICAgICBwYW5lbC5sYXp5TG9hZChub2RlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgLy8gZG8gbm90IHVzZSBjYWNoZWQgbGVhZiB2YWx1ZSBoZXJlLCBpbnZva2UgdGhpcy5pc0xlYWYgdG8gZ2V0IG5ldyB2YWx1ZS4KICAgICAgICAgICAgICB2YXIgaXNMZWFmID0gX3RoaXMyLmlzTGVhZjsKICAgICAgICAgICAgICBpZiAoIWlzTGVhZikgX3RoaXMyLmhhbmRsZUV4cGFuZCgpOwoKICAgICAgICAgICAgICBpZiAobXVsdGlwbGUpIHsKICAgICAgICAgICAgICAgIC8vIGlmIGxlYWYgc3luYyBjaGVja2VkIHN0YXRlLCBlbHNlIGNsZWFyIGNoZWNrZWQgc3RhdGUKICAgICAgICAgICAgICAgIHZhciBjaGVja2VkID0gaXNMZWFmID8gbm9kZS5jaGVja2VkIDogZmFsc2U7CgogICAgICAgICAgICAgICAgX3RoaXMyLmhhbmRsZU11bHRpQ2hlY2tDaGFuZ2UoY2hlY2tlZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBhbmVsLmhhbmRsZUV4cGFuZChub2RlKTsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGhhbmRsZUNoZWNrQ2hhbmdlOiBmdW5jdGlvbiBoYW5kbGVDaGVja0NoYW5nZSgpIHsKICAgICAgICAgIHZhciBwYW5lbCA9IHRoaXMucGFuZWwsCiAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLnZhbHVlLAogICAgICAgICAgICAgIG5vZGUgPSB0aGlzLm5vZGU7CiAgICAgICAgICBwYW5lbC5oYW5kbGVDaGVja0NoYW5nZSh2YWx1ZSk7CiAgICAgICAgICBwYW5lbC5oYW5kbGVFeHBhbmQobm9kZSk7CiAgICAgICAgfSwKICAgICAgICBoYW5kbGVNdWx0aUNoZWNrQ2hhbmdlOiBmdW5jdGlvbiBoYW5kbGVNdWx0aUNoZWNrQ2hhbmdlKGNoZWNrZWQpIHsKICAgICAgICAgIHRoaXMubm9kZS5kb0NoZWNrKGNoZWNrZWQpOwogICAgICAgICAgdGhpcy5wYW5lbC5jYWxjdWxhdGVNdWx0aUNoZWNrZWRWYWx1ZSgpOwogICAgICAgIH0sCiAgICAgICAgaXNJblBhdGg6IGZ1bmN0aW9uIGlzSW5QYXRoKHBhdGhOb2RlcykgewogICAgICAgICAgdmFyIG5vZGUgPSB0aGlzLm5vZGU7CiAgICAgICAgICB2YXIgc2VsZWN0ZWRQYXRoTm9kZSA9IHBhdGhOb2Rlc1tub2RlLmxldmVsIC0gMV0gfHwge307CiAgICAgICAgICByZXR1cm4gc2VsZWN0ZWRQYXRoTm9kZS51aWQgPT09IG5vZGUudWlkOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyUHJlZml4OiBmdW5jdGlvbiByZW5kZXJQcmVmaXgoaCkgewogICAgICAgICAgdmFyIGlzTGVhZiA9IHRoaXMuaXNMZWFmLAogICAgICAgICAgICAgIGlzQ2hlY2tlZCA9IHRoaXMuaXNDaGVja2VkLAogICAgICAgICAgICAgIGNvbmZpZyA9IHRoaXMuY29uZmlnOwogICAgICAgICAgdmFyIGNoZWNrU3RyaWN0bHkgPSBjb25maWcuY2hlY2tTdHJpY3RseSwKICAgICAgICAgICAgICBtdWx0aXBsZSA9IGNvbmZpZy5tdWx0aXBsZTsKCiAgICAgICAgICBpZiAobXVsdGlwbGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyQ2hlY2tib3goaCk7CiAgICAgICAgICB9IGVsc2UgaWYgKGNoZWNrU3RyaWN0bHkpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyUmFkaW8oaCk7CiAgICAgICAgICB9IGVsc2UgaWYgKGlzTGVhZiAmJiBpc0NoZWNrZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyQ2hlY2tJY29uKGgpOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyUG9zdGZpeDogZnVuY3Rpb24gcmVuZGVyUG9zdGZpeChoKSB7CiAgICAgICAgICB2YXIgbm9kZSA9IHRoaXMubm9kZSwKICAgICAgICAgICAgICBpc0xlYWYgPSB0aGlzLmlzTGVhZjsKCiAgICAgICAgICBpZiAobm9kZS5sb2FkaW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlckxvYWRpbmdJY29uKGgpOwogICAgICAgICAgfSBlbHNlIGlmICghaXNMZWFmKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlckV4cGFuZEljb24oaCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSwKICAgICAgICByZW5kZXJDaGVja2JveDogZnVuY3Rpb24gcmVuZGVyQ2hlY2tib3goaCkgewogICAgICAgICAgdmFyIG5vZGUgPSB0aGlzLm5vZGUsCiAgICAgICAgICAgICAgY29uZmlnID0gdGhpcy5jb25maWcsCiAgICAgICAgICAgICAgaXNEaXNhYmxlZCA9IHRoaXMuaXNEaXNhYmxlZDsKICAgICAgICAgIHZhciBldmVudHMgPSB7CiAgICAgICAgICAgIG9uOiB7CiAgICAgICAgICAgICAgY2hhbmdlOiB0aGlzLmhhbmRsZU11bHRpQ2hlY2tDaGFuZ2UKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbmF0aXZlT246IHt9CiAgICAgICAgICB9OwoKICAgICAgICAgIGlmIChjb25maWcuY2hlY2tTdHJpY3RseSkgewogICAgICAgICAgICAvLyB3aGVuIGV2ZXJ5IG5vZGUgaXMgc2VsZWN0YWJsZSwgY2xpY2sgZXZlbnQgc2hvdWxkIG5vdCB0cmlnZ2VyIGV4cGFuZCBldmVudC4KICAgICAgICAgICAgZXZlbnRzLm5hdGl2ZU9uLmNsaWNrID0gc3RvcFByb3BhZ2F0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiBoKCdlbC1jaGVja2JveCcsIGV4dGVybmFsX2JhYmVsX2hlbHBlcl92dWVfanN4X21lcmdlX3Byb3BzX2RlZmF1bHQoKShbewogICAgICAgICAgICBhdHRyczogewogICAgICAgICAgICAgIHZhbHVlOiBub2RlLmNoZWNrZWQsCiAgICAgICAgICAgICAgaW5kZXRlcm1pbmF0ZTogbm9kZS5pbmRldGVybWluYXRlLAogICAgICAgICAgICAgIGRpc2FibGVkOiBpc0Rpc2FibGVkCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIGV2ZW50c10pKTsKICAgICAgICB9LAogICAgICAgIHJlbmRlclJhZGlvOiBmdW5jdGlvbiByZW5kZXJSYWRpbyhoKSB7CiAgICAgICAgICB2YXIgY2hlY2tlZFZhbHVlID0gdGhpcy5jaGVja2VkVmFsdWUsCiAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLnZhbHVlLAogICAgICAgICAgICAgIGlzRGlzYWJsZWQgPSB0aGlzLmlzRGlzYWJsZWQ7IC8vIHRvIGtlZXAgc2FtZSByZWZlcmVuY2UgaWYgdmFsdWUgY2F1c2UgcmFkaW8ncyBjaGVja2VkIHN0YXRlIGlzIGNhbGN1bGF0ZWQgYnkgcmVmZXJlbmNlIGNvbXBhcmlzaW9uOwoKICAgICAgICAgIGlmIChPYmplY3QodXRpbF9bImlzRXF1YWwiXSkodmFsdWUsIGNoZWNrZWRWYWx1ZSkpIHsKICAgICAgICAgICAgdmFsdWUgPSBjaGVja2VkVmFsdWU7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGgoJ2VsLXJhZGlvJywgewogICAgICAgICAgICBhdHRyczogewogICAgICAgICAgICAgIHZhbHVlOiBjaGVja2VkVmFsdWUsCiAgICAgICAgICAgICAgbGFiZWw6IHZhbHVlLAogICAgICAgICAgICAgIGRpc2FibGVkOiBpc0Rpc2FibGVkCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG9uOiB7CiAgICAgICAgICAgICAgJ2NoYW5nZSc6IHRoaXMuaGFuZGxlQ2hlY2tDaGFuZ2UKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbmF0aXZlT246IHsKICAgICAgICAgICAgICAnY2xpY2snOiBzdG9wUHJvcGFnYXRpb24KICAgICAgICAgICAgfQogICAgICAgICAgfSwgW2goJ3NwYW4nKV0pOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyQ2hlY2tJY29uOiBmdW5jdGlvbiByZW5kZXJDaGVja0ljb24oaCkgewogICAgICAgICAgcmV0dXJuIGgoJ2knLCB7CiAgICAgICAgICAgICdjbGFzcyc6ICdlbC1pY29uLWNoZWNrIGVsLWNhc2NhZGVyLW5vZGVfX3ByZWZpeCcKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyTG9hZGluZ0ljb246IGZ1bmN0aW9uIHJlbmRlckxvYWRpbmdJY29uKGgpIHsKICAgICAgICAgIHJldHVybiBoKCdpJywgewogICAgICAgICAgICAnY2xhc3MnOiAnZWwtaWNvbi1sb2FkaW5nIGVsLWNhc2NhZGVyLW5vZGVfX3Bvc3RmaXgnCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHJlbmRlckV4cGFuZEljb246IGZ1bmN0aW9uIHJlbmRlckV4cGFuZEljb24oaCkgewogICAgICAgICAgcmV0dXJuIGgoJ2knLCB7CiAgICAgICAgICAgICdjbGFzcyc6ICdlbC1pY29uLWFycm93LXJpZ2h0IGVsLWNhc2NhZGVyLW5vZGVfX3Bvc3RmaXgnCiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIHJlbmRlckNvbnRlbnQ6IGZ1bmN0aW9uIHJlbmRlckNvbnRlbnQoaCkgewogICAgICAgICAgdmFyIHBhbmVsID0gdGhpcy5wYW5lbCwKICAgICAgICAgICAgICBub2RlID0gdGhpcy5ub2RlOwogICAgICAgICAgdmFyIHJlbmRlciA9IHBhbmVsLnJlbmRlckxhYmVsRm47CiAgICAgICAgICB2YXIgdm5vZGUgPSByZW5kZXIgPyByZW5kZXIoewogICAgICAgICAgICBub2RlOiBub2RlLAogICAgICAgICAgICBkYXRhOiBub2RlLmRhdGEKICAgICAgICAgIH0pIDogbnVsbDsKICAgICAgICAgIHJldHVybiBoKCdzcGFuJywgewogICAgICAgICAgICAnY2xhc3MnOiAnZWwtY2FzY2FkZXItbm9kZV9fbGFiZWwnCiAgICAgICAgICB9LCBbdm5vZGUgfHwgbm9kZS5sYWJlbF0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoaCkgewogICAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgICB2YXIgaW5BY3RpdmVQYXRoID0gdGhpcy5pbkFjdGl2ZVBhdGgsCiAgICAgICAgICAgIGluQ2hlY2tlZFBhdGggPSB0aGlzLmluQ2hlY2tlZFBhdGgsCiAgICAgICAgICAgIGlzQ2hlY2tlZCA9IHRoaXMuaXNDaGVja2VkLAogICAgICAgICAgICBpc0xlYWYgPSB0aGlzLmlzTGVhZiwKICAgICAgICAgICAgaXNEaXNhYmxlZCA9IHRoaXMuaXNEaXNhYmxlZCwKICAgICAgICAgICAgY29uZmlnID0gdGhpcy5jb25maWcsCiAgICAgICAgICAgIG5vZGVJZCA9IHRoaXMubm9kZUlkOwogICAgICAgIHZhciBleHBhbmRUcmlnZ2VyID0gY29uZmlnLmV4cGFuZFRyaWdnZXIsCiAgICAgICAgICAgIGNoZWNrU3RyaWN0bHkgPSBjb25maWcuY2hlY2tTdHJpY3RseSwKICAgICAgICAgICAgbXVsdGlwbGUgPSBjb25maWcubXVsdGlwbGU7CiAgICAgICAgdmFyIGRpc2FibGVkID0gIWNoZWNrU3RyaWN0bHkgJiYgaXNEaXNhYmxlZDsKICAgICAgICB2YXIgZXZlbnRzID0gewogICAgICAgICAgb246IHt9CiAgICAgICAgfTsKCiAgICAgICAgaWYgKGV4cGFuZFRyaWdnZXIgPT09ICdjbGljaycpIHsKICAgICAgICAgIGV2ZW50cy5vbi5jbGljayA9IHRoaXMuaGFuZGxlRXhwYW5kOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBldmVudHMub24ubW91c2VlbnRlciA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF90aGlzMy5oYW5kbGVFeHBhbmQoKTsKCiAgICAgICAgICAgIF90aGlzMy4kZW1pdCgnZXhwYW5kJywgZSk7CiAgICAgICAgICB9OwoKICAgICAgICAgIGV2ZW50cy5vbi5mb2N1cyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIF90aGlzMy5oYW5kbGVFeHBhbmQoKTsKCiAgICAgICAgICAgIF90aGlzMy4kZW1pdCgnZXhwYW5kJywgZSk7CiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzTGVhZiAmJiAhaXNEaXNhYmxlZCAmJiAhY2hlY2tTdHJpY3RseSAmJiAhbXVsdGlwbGUpIHsKICAgICAgICAgIGV2ZW50cy5vbi5jbGljayA9IHRoaXMuaGFuZGxlQ2hlY2tDaGFuZ2U7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gaCgnbGknLCBleHRlcm5hbF9iYWJlbF9oZWxwZXJfdnVlX2pzeF9tZXJnZV9wcm9wc19kZWZhdWx0KCkoW3sKICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgIHJvbGU6ICdtZW51aXRlbScsCiAgICAgICAgICAgIGlkOiBub2RlSWQsCiAgICAgICAgICAgICdhcmlhLWV4cGFuZGVkJzogaW5BY3RpdmVQYXRoLAogICAgICAgICAgICB0YWJpbmRleDogZGlzYWJsZWQgPyBudWxsIDogLTEKICAgICAgICAgIH0sCiAgICAgICAgICAnY2xhc3MnOiB7CiAgICAgICAgICAgICdlbC1jYXNjYWRlci1ub2RlJzogdHJ1ZSwKICAgICAgICAgICAgJ2lzLXNlbGVjdGFibGUnOiBjaGVja1N0cmljdGx5LAogICAgICAgICAgICAnaW4tYWN0aXZlLXBhdGgnOiBpbkFjdGl2ZVBhdGgsCiAgICAgICAgICAgICdpbi1jaGVja2VkLXBhdGgnOiBpbkNoZWNrZWRQYXRoLAogICAgICAgICAgICAnaXMtYWN0aXZlJzogaXNDaGVja2VkLAogICAgICAgICAgICAnaXMtZGlzYWJsZWQnOiBkaXNhYmxlZAogICAgICAgICAgfQogICAgICAgIH0sIGV2ZW50c10pLCBbdGhpcy5yZW5kZXJQcmVmaXgoaCksIHRoaXMucmVuZGVyQ29udGVudChoKSwgdGhpcy5yZW5kZXJQb3N0Zml4KGgpXSk7CiAgICAgIH0KICAgIH07IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vcGFja2FnZXMvY2FzY2FkZXItcGFuZWwvc3JjL2Nhc2NhZGVyLW5vZGUudnVlP3Z1ZSZ0eXBlPXNjcmlwdCZsYW5nPWpzJgoKICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8KCiAgICB2YXIgc3JjX2Nhc2NhZGVyX25vZGV2dWVfdHlwZV9zY3JpcHRfbGFuZ19qc18gPSBjYXNjYWRlcl9ub2RldnVlX3R5cGVfc2NyaXB0X2xhbmdfanNfOyAvLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3Z1ZS1sb2FkZXIvbGliL3J1bnRpbWUvY29tcG9uZW50Tm9ybWFsaXplci5qcwoKICAgIHZhciBjb21wb25lbnROb3JtYWxpemVyID0gX193ZWJwYWNrX3JlcXVpcmVfXygwKTsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9wYWNrYWdlcy9jYXNjYWRlci1wYW5lbC9zcmMvY2FzY2FkZXItbm9kZS52dWUKCgogICAgdmFyIGNhc2NhZGVyX25vZGVfcmVuZGVyLCBjYXNjYWRlcl9ub2RlX3N0YXRpY1JlbmRlckZuczsKICAgIC8qIG5vcm1hbGl6ZSBjb21wb25lbnQgKi8KCiAgICB2YXIgY29tcG9uZW50ID0gT2JqZWN0KGNvbXBvbmVudE5vcm1hbGl6ZXJbImEiCiAgICAvKiBkZWZhdWx0ICovCiAgICBdKShzcmNfY2FzY2FkZXJfbm9kZXZ1ZV90eXBlX3NjcmlwdF9sYW5nX2pzXywgY2FzY2FkZXJfbm9kZV9yZW5kZXIsIGNhc2NhZGVyX25vZGVfc3RhdGljUmVuZGVyRm5zLCBmYWxzZSwgbnVsbCwgbnVsbCwgbnVsbCk7CiAgICAvKiBob3QgcmVsb2FkICovCgogICAgaWYgKGZhbHNlKSB7CiAgICAgIHZhciBhcGk7CiAgICB9CgogICAgY29tcG9uZW50Lm9wdGlvbnMuX19maWxlID0gInBhY2thZ2VzL2Nhc2NhZGVyLXBhbmVsL3NyYy9jYXNjYWRlci1ub2RlLnZ1ZSI7CiAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovCgogICAgdmFyIGNhc2NhZGVyX25vZGUgPSBjb21wb25lbnQuZXhwb3J0czsgLy8gRVhURVJOQUwgTU9EVUxFOiBleHRlcm5hbCAiZWxlbWVudC11aS9saWIvbWl4aW5zL2xvY2FsZSIKCiAgICB2YXIgbG9jYWxlXyA9IF9fd2VicGFja19yZXF1aXJlX18oNik7CgogICAgdmFyIGxvY2FsZV9kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihsb2NhbGVfKTsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvYmFiZWwtbG9hZGVyL2xpYiEuL25vZGVfbW9kdWxlcy92dWUtbG9hZGVyL2xpYj8/dnVlLWxvYWRlci1vcHRpb25zIS4vcGFja2FnZXMvY2FzY2FkZXItcGFuZWwvc3JjL2Nhc2NhZGVyLW1lbnUudnVlP3Z1ZSZ0eXBlPXNjcmlwdCZsYW5nPWpzJgoKICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8KCgogICAgdmFyIGNhc2NhZGVyX21lbnV2dWVfdHlwZV9zY3JpcHRfbGFuZ19qc18gPSB7CiAgICAgIG5hbWU6ICdFbENhc2NhZGVyTWVudScsCiAgICAgIG1peGluczogW2xvY2FsZV9kZWZhdWx0LmFdLAogICAgICBpbmplY3Q6IFsncGFuZWwnXSwKICAgICAgY29tcG9uZW50czogewogICAgICAgIEVsU2Nyb2xsYmFyOiBzY3JvbGxiYXJfZGVmYXVsdC5hLAogICAgICAgIENhc2NhZGVyTm9kZTogY2FzY2FkZXJfbm9kZQogICAgICB9LAogICAgICBwcm9wczogewogICAgICAgIG5vZGVzOiB7CiAgICAgICAgICB0eXBlOiBBcnJheSwKICAgICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgfSwKICAgICAgICBpbmRleDogTnVtYmVyCiAgICAgIH0sCiAgICAgIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGFjdGl2ZU5vZGU6IG51bGwsCiAgICAgICAgICBob3ZlclRpbWVyOiBudWxsLAogICAgICAgICAgaWQ6IE9iamVjdCh1dGlsX1siZ2VuZXJhdGVJZCJdKSgpCiAgICAgICAgfTsKICAgICAgfSwKICAgICAgY29tcHV0ZWQ6IHsKICAgICAgICBpc0VtcHR5OiBmdW5jdGlvbiBpc0VtcHR5KCkgewogICAgICAgICAgcmV0dXJuICF0aGlzLm5vZGVzLmxlbmd0aDsKICAgICAgICB9LAogICAgICAgIG1lbnVJZDogZnVuY3Rpb24gbWVudUlkKCkgewogICAgICAgICAgcmV0dXJuICdjYXNjYWRlci1tZW51LScgKyB0aGlzLmlkICsgJy0nICsgdGhpcy5pbmRleDsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1ldGhvZHM6IHsKICAgICAgICBoYW5kbGVFeHBhbmQ6IGZ1bmN0aW9uIGhhbmRsZUV4cGFuZChlKSB7CiAgICAgICAgICB0aGlzLmFjdGl2ZU5vZGUgPSBlLnRhcmdldDsKICAgICAgICB9LAogICAgICAgIGhhbmRsZU1vdXNlTW92ZTogZnVuY3Rpb24gaGFuZGxlTW91c2VNb3ZlKGUpIHsKICAgICAgICAgIHZhciBhY3RpdmVOb2RlID0gdGhpcy5hY3RpdmVOb2RlLAogICAgICAgICAgICAgIGhvdmVyVGltZXIgPSB0aGlzLmhvdmVyVGltZXI7CiAgICAgICAgICB2YXIgaG92ZXJab25lID0gdGhpcy4kcmVmcy5ob3ZlclpvbmU7CiAgICAgICAgICBpZiAoIWFjdGl2ZU5vZGUgfHwgIWhvdmVyWm9uZSkgcmV0dXJuOwoKICAgICAgICAgIGlmIChhY3RpdmVOb2RlLmNvbnRhaW5zKGUudGFyZ2V0KSkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQoaG92ZXJUaW1lcik7CgogICAgICAgICAgICB2YXIgXyRlbCRnZXRCb3VuZGluZ0NsaWVuID0gdGhpcy4kZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksCiAgICAgICAgICAgICAgICBsZWZ0ID0gXyRlbCRnZXRCb3VuZGluZ0NsaWVuLmxlZnQ7CgogICAgICAgICAgICB2YXIgc3RhcnRYID0gZS5jbGllbnRYIC0gbGVmdDsKICAgICAgICAgICAgdmFyIF8kZWwgPSB0aGlzLiRlbCwKICAgICAgICAgICAgICAgIG9mZnNldFdpZHRoID0gXyRlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgICAgIG9mZnNldEhlaWdodCA9IF8kZWwub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICB2YXIgdG9wID0gYWN0aXZlTm9kZS5vZmZzZXRUb3A7CiAgICAgICAgICAgIHZhciBib3R0b20gPSB0b3AgKyBhY3RpdmVOb2RlLm9mZnNldEhlaWdodDsKICAgICAgICAgICAgaG92ZXJab25lLmlubmVySFRNTCA9ICdcbiAgICAgICAgICA8cGF0aCBzdHlsZT0icG9pbnRlci1ldmVudHM6IGF1dG87IiBmaWxsPSJ0cmFuc3BhcmVudCIgZD0iTScgKyBzdGFydFggKyAnICcgKyB0b3AgKyAnIEwnICsgb2Zmc2V0V2lkdGggKyAnIDAgVicgKyB0b3AgKyAnIFoiIC8+XG4gICAgICAgICAgPHBhdGggc3R5bGU9InBvaW50ZXItZXZlbnRzOiBhdXRvOyIgZmlsbD0idHJhbnNwYXJlbnQiIGQ9Ik0nICsgc3RhcnRYICsgJyAnICsgYm90dG9tICsgJyBMJyArIG9mZnNldFdpZHRoICsgJyAnICsgb2Zmc2V0SGVpZ2h0ICsgJyBWJyArIGJvdHRvbSArICcgWiIgLz5cbiAgICAgICAgJzsKICAgICAgICAgIH0gZWxzZSBpZiAoIWhvdmVyVGltZXIpIHsKICAgICAgICAgICAgdGhpcy5ob3ZlclRpbWVyID0gc2V0VGltZW91dCh0aGlzLmNsZWFySG92ZXJab25lLCB0aGlzLnBhbmVsLmNvbmZpZy5ob3ZlclRocmVzaG9sZCk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjbGVhckhvdmVyWm9uZTogZnVuY3Rpb24gY2xlYXJIb3ZlclpvbmUoKSB7CiAgICAgICAgICB2YXIgaG92ZXJab25lID0gdGhpcy4kcmVmcy5ob3ZlclpvbmU7CiAgICAgICAgICBpZiAoIWhvdmVyWm9uZSkgcmV0dXJuOwogICAgICAgICAgaG92ZXJab25lLmlubmVySFRNTCA9ICcnOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyRW1wdHlUZXh0OiBmdW5jdGlvbiByZW5kZXJFbXB0eVRleHQoaCkgewogICAgICAgICAgcmV0dXJuIGgoJ2RpdicsIHsKICAgICAgICAgICAgJ2NsYXNzJzogJ2VsLWNhc2NhZGVyLW1lbnVfX2VtcHR5LXRleHQnCiAgICAgICAgICB9LCBbdGhpcy50KCdlbC5jYXNjYWRlci5ub0RhdGEnKV0pOwogICAgICAgIH0sCiAgICAgICAgcmVuZGVyTm9kZUxpc3Q6IGZ1bmN0aW9uIHJlbmRlck5vZGVMaXN0KGgpIHsKICAgICAgICAgIHZhciBtZW51SWQgPSB0aGlzLm1lbnVJZDsKICAgICAgICAgIHZhciBpc0hvdmVyTWVudSA9IHRoaXMucGFuZWwuaXNIb3Zlck1lbnU7CiAgICAgICAgICB2YXIgZXZlbnRzID0gewogICAgICAgICAgICBvbjoge30KICAgICAgICAgIH07CgogICAgICAgICAgaWYgKGlzSG92ZXJNZW51KSB7CiAgICAgICAgICAgIGV2ZW50cy5vbi5leHBhbmQgPSB0aGlzLmhhbmRsZUV4cGFuZDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbm9kZXMgPSB0aGlzLm5vZGVzLm1hcChmdW5jdGlvbiAobm9kZSwgaW5kZXgpIHsKICAgICAgICAgICAgdmFyIGhhc0NoaWxkcmVuID0gbm9kZS5oYXNDaGlsZHJlbjsKICAgICAgICAgICAgcmV0dXJuIGgoJ2Nhc2NhZGVyLW5vZGUnLCBleHRlcm5hbF9iYWJlbF9oZWxwZXJfdnVlX2pzeF9tZXJnZV9wcm9wc19kZWZhdWx0KCkoW3sKICAgICAgICAgICAgICBrZXk6IG5vZGUudWlkLAogICAgICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgICAgICBub2RlOiBub2RlLAogICAgICAgICAgICAgICAgJ25vZGUtaWQnOiBtZW51SWQgKyAnLScgKyBpbmRleCwKICAgICAgICAgICAgICAgICdhcmlhLWhhc3BvcHVwJzogaGFzQ2hpbGRyZW4sCiAgICAgICAgICAgICAgICAnYXJpYS1vd25zJzogaGFzQ2hpbGRyZW4gPyBtZW51SWQgOiBudWxsCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBldmVudHNdKSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBbXS5jb25jYXQobm9kZXMsIFtpc0hvdmVyTWVudSA/IGgoJ3N2ZycsIHsKICAgICAgICAgICAgcmVmOiAnaG92ZXJab25lJywKICAgICAgICAgICAgJ2NsYXNzJzogJ2VsLWNhc2NhZGVyLW1lbnVfX2hvdmVyLXpvbmUnCiAgICAgICAgICB9KSA6IG51bGxdKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKGgpIHsKICAgICAgICB2YXIgaXNFbXB0eSA9IHRoaXMuaXNFbXB0eSwKICAgICAgICAgICAgbWVudUlkID0gdGhpcy5tZW51SWQ7CiAgICAgICAgdmFyIGV2ZW50cyA9IHsKICAgICAgICAgIG5hdGl2ZU9uOiB7fQogICAgICAgIH07IC8vIG9wdGltaXplIGhvdmVyIHRvIGV4cGFuZCBleHBlcmllbmNlICgjODAxMCkKCiAgICAgICAgaWYgKHRoaXMucGFuZWwuaXNIb3Zlck1lbnUpIHsKICAgICAgICAgIGV2ZW50cy5uYXRpdmVPbi5tb3VzZW1vdmUgPSB0aGlzLmhhbmRsZU1vdXNlTW92ZTsgLy8gZXZlbnRzLm5hdGl2ZU9uLm1vdXNlbGVhdmUgPSB0aGlzLmNsZWFySG92ZXJab25lOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGgoJ2VsLXNjcm9sbGJhcicsIGV4dGVybmFsX2JhYmVsX2hlbHBlcl92dWVfanN4X21lcmdlX3Byb3BzX2RlZmF1bHQoKShbewogICAgICAgICAgYXR0cnM6IHsKICAgICAgICAgICAgdGFnOiAndWwnLAogICAgICAgICAgICByb2xlOiAnbWVudScsCiAgICAgICAgICAgIGlkOiBtZW51SWQsCiAgICAgICAgICAgICd3cmFwLWNsYXNzJzogJ2VsLWNhc2NhZGVyLW1lbnVfX3dyYXAnLAogICAgICAgICAgICAndmlldy1jbGFzcyc6IHsKICAgICAgICAgICAgICAnZWwtY2FzY2FkZXItbWVudV9fbGlzdCc6IHRydWUsCiAgICAgICAgICAgICAgJ2lzLWVtcHR5JzogaXNFbXB0eQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgJ2NsYXNzJzogJ2VsLWNhc2NhZGVyLW1lbnUnCiAgICAgICAgfSwgZXZlbnRzXSksIFtpc0VtcHR5ID8gdGhpcy5yZW5kZXJFbXB0eVRleHQoaCkgOiB0aGlzLnJlbmRlck5vZGVMaXN0KGgpXSk7CiAgICAgIH0KICAgIH07IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vcGFja2FnZXMvY2FzY2FkZXItcGFuZWwvc3JjL2Nhc2NhZGVyLW1lbnUudnVlP3Z1ZSZ0eXBlPXNjcmlwdCZsYW5nPWpzJgoKICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8KCiAgICB2YXIgc3JjX2Nhc2NhZGVyX21lbnV2dWVfdHlwZV9zY3JpcHRfbGFuZ19qc18gPSBjYXNjYWRlcl9tZW51dnVlX3R5cGVfc2NyaXB0X2xhbmdfanNfOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3BhY2thZ2VzL2Nhc2NhZGVyLXBhbmVsL3NyYy9jYXNjYWRlci1tZW51LnZ1ZQoKICAgIHZhciBjYXNjYWRlcl9tZW51X3JlbmRlciwgY2FzY2FkZXJfbWVudV9zdGF0aWNSZW5kZXJGbnM7CiAgICAvKiBub3JtYWxpemUgY29tcG9uZW50ICovCgogICAgdmFyIGNhc2NhZGVyX21lbnVfY29tcG9uZW50ID0gT2JqZWN0KGNvbXBvbmVudE5vcm1hbGl6ZXJbImEiCiAgICAvKiBkZWZhdWx0ICovCiAgICBdKShzcmNfY2FzY2FkZXJfbWVudXZ1ZV90eXBlX3NjcmlwdF9sYW5nX2pzXywgY2FzY2FkZXJfbWVudV9yZW5kZXIsIGNhc2NhZGVyX21lbnVfc3RhdGljUmVuZGVyRm5zLCBmYWxzZSwgbnVsbCwgbnVsbCwgbnVsbCk7CiAgICAvKiBob3QgcmVsb2FkICovCgogICAgaWYgKGZhbHNlKSB7CiAgICAgIHZhciBjYXNjYWRlcl9tZW51X2FwaTsKICAgIH0KCiAgICBjYXNjYWRlcl9tZW51X2NvbXBvbmVudC5vcHRpb25zLl9fZmlsZSA9ICJwYWNrYWdlcy9jYXNjYWRlci1wYW5lbC9zcmMvY2FzY2FkZXItbWVudS52dWUiOwogICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLwoKICAgIHZhciBjYXNjYWRlcl9tZW51ID0gY2FzY2FkZXJfbWVudV9jb21wb25lbnQuZXhwb3J0czsgLy8gRVhURVJOQUwgTU9EVUxFOiBleHRlcm5hbCAiZWxlbWVudC11aS9saWIvdXRpbHMvc2hhcmVkIgoKICAgIHZhciBzaGFyZWRfID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMSk7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vcGFja2FnZXMvY2FzY2FkZXItcGFuZWwvc3JjL25vZGUuanMKCgogICAgdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgICAgICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgICAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICAgICAgICBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwogICAgICAgIGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogICAgICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICAgICAgfTsKICAgIH0oKTsKCiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7CiAgICAgIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgdWlkID0gMDsKCiAgICB2YXIgbm9kZV9Ob2RlID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBOb2RlKGRhdGEsIGNvbmZpZywgcGFyZW50Tm9kZSkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBOb2RlKTsKCiAgICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZzsKICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudE5vZGUgfHwgbnVsbDsKICAgICAgICB0aGlzLmxldmVsID0gIXRoaXMucGFyZW50ID8gMSA6IHRoaXMucGFyZW50LmxldmVsICsgMTsKICAgICAgICB0aGlzLnVpZCA9IHVpZCsrOwogICAgICAgIHRoaXMuaW5pdFN0YXRlKCk7CiAgICAgICAgdGhpcy5pbml0Q2hpbGRyZW4oKTsKICAgICAgfQoKICAgICAgTm9kZS5wcm90b3R5cGUuaW5pdFN0YXRlID0gZnVuY3Rpb24gaW5pdFN0YXRlKCkgewogICAgICAgIHZhciBfY29uZmlnID0gdGhpcy5jb25maWcsCiAgICAgICAgICAgIHZhbHVlS2V5ID0gX2NvbmZpZy52YWx1ZSwKICAgICAgICAgICAgbGFiZWxLZXkgPSBfY29uZmlnLmxhYmVsOwogICAgICAgIHRoaXMudmFsdWUgPSB0aGlzLmRhdGFbdmFsdWVLZXldOwogICAgICAgIHRoaXMubGFiZWwgPSB0aGlzLmRhdGFbbGFiZWxLZXldOwogICAgICAgIHRoaXMucGF0aE5vZGVzID0gdGhpcy5jYWxjdWxhdGVQYXRoTm9kZXMoKTsKICAgICAgICB0aGlzLnBhdGggPSB0aGlzLnBhdGhOb2Rlcy5tYXAoZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAgIHJldHVybiBub2RlLnZhbHVlOwogICAgICAgIH0pOwogICAgICAgIHRoaXMucGF0aExhYmVscyA9IHRoaXMucGF0aE5vZGVzLm1hcChmdW5jdGlvbiAobm9kZSkgewogICAgICAgICAgcmV0dXJuIG5vZGUubGFiZWw7CiAgICAgICAgfSk7IC8vIGxhenkgbG9hZAoKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLmxvYWRlZCA9IGZhbHNlOwogICAgICB9OwoKICAgICAgTm9kZS5wcm90b3R5cGUuaW5pdENoaWxkcmVuID0gZnVuY3Rpb24gaW5pdENoaWxkcmVuKCkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZzsKICAgICAgICB2YXIgY2hpbGRyZW5LZXkgPSBjb25maWcuY2hpbGRyZW47CiAgICAgICAgdmFyIGNoaWxkcmVuRGF0YSA9IHRoaXMuZGF0YVtjaGlsZHJlbktleV07CiAgICAgICAgdGhpcy5oYXNDaGlsZHJlbiA9IEFycmF5LmlzQXJyYXkoY2hpbGRyZW5EYXRhKTsKICAgICAgICB0aGlzLmNoaWxkcmVuID0gKGNoaWxkcmVuRGF0YSB8fCBbXSkubWFwKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgICAgcmV0dXJuIG5ldyBOb2RlKGNoaWxkLCBjb25maWcsIF90aGlzKTsKICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIE5vZGUucHJvdG90eXBlLmNhbGN1bGF0ZVBhdGhOb2RlcyA9IGZ1bmN0aW9uIGNhbGN1bGF0ZVBhdGhOb2RlcygpIHsKICAgICAgICB2YXIgbm9kZXMgPSBbdGhpc107CiAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMucGFyZW50OwoKICAgICAgICB3aGlsZSAocGFyZW50KSB7CiAgICAgICAgICBub2Rlcy51bnNoaWZ0KHBhcmVudCk7CiAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50OwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5vZGVzOwogICAgICB9OwoKICAgICAgTm9kZS5wcm90b3R5cGUuZ2V0UGF0aCA9IGZ1bmN0aW9uIGdldFBhdGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucGF0aDsKICAgICAgfTsKCiAgICAgIE5vZGUucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWU7CiAgICAgIH07CgogICAgICBOb2RlLnByb3RvdHlwZS5nZXRWYWx1ZUJ5T3B0aW9uID0gZnVuY3Rpb24gZ2V0VmFsdWVCeU9wdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25maWcuZW1pdFBhdGggPyB0aGlzLmdldFBhdGgoKSA6IHRoaXMuZ2V0VmFsdWUoKTsKICAgICAgfTsKCiAgICAgIE5vZGUucHJvdG90eXBlLmdldFRleHQgPSBmdW5jdGlvbiBnZXRUZXh0KGFsbExldmVscywgc2VwYXJhdG9yKSB7CiAgICAgICAgcmV0dXJuIGFsbExldmVscyA/IHRoaXMucGF0aExhYmVscy5qb2luKHNlcGFyYXRvcikgOiB0aGlzLmxhYmVsOwogICAgICB9OwoKICAgICAgTm9kZS5wcm90b3R5cGUuaXNTYW1lTm9kZSA9IGZ1bmN0aW9uIGlzU2FtZU5vZGUoY2hlY2tlZFZhbHVlKSB7CiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5nZXRWYWx1ZUJ5T3B0aW9uKCk7CiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLm11bHRpcGxlICYmIEFycmF5LmlzQXJyYXkoY2hlY2tlZFZhbHVlKSA/IGNoZWNrZWRWYWx1ZS5zb21lKGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgIHJldHVybiBPYmplY3QodXRpbF9bImlzRXF1YWwiXSkodmFsLCB2YWx1ZSk7CiAgICAgICAgfSkgOiBPYmplY3QodXRpbF9bImlzRXF1YWwiXSkoY2hlY2tlZFZhbHVlLCB2YWx1ZSk7CiAgICAgIH07CgogICAgICBOb2RlLnByb3RvdHlwZS5icm9hZGNhc3QgPSBmdW5jdGlvbiBicm9hZGNhc3QoZXZlbnQpIHsKICAgICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYXJncyA9IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgICAgIGFyZ3NbX2tleSAtIDFdID0gYXJndW1lbnRzW19rZXldOwogICAgICAgIH0KCiAgICAgICAgdmFyIGhhbmRsZXJOYW1lID0gJ29uUGFyZW50JyArIE9iamVjdCh1dGlsX1siY2FwaXRhbGl6ZSJdKShldmVudCk7CiAgICAgICAgdGhpcy5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgICAgaWYgKGNoaWxkKSB7CiAgICAgICAgICAgIC8vIGJvdHRvbSB1cAogICAgICAgICAgICBjaGlsZC5icm9hZGNhc3QuYXBwbHkoY2hpbGQsIFtldmVudF0uY29uY2F0KGFyZ3MpKTsKICAgICAgICAgICAgY2hpbGRbaGFuZGxlck5hbWVdICYmIGNoaWxkW2hhbmRsZXJOYW1lXS5hcHBseShjaGlsZCwgYXJncyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICBOb2RlLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gZW1pdChldmVudCkgewogICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLnBhcmVudDsKICAgICAgICB2YXIgaGFuZGxlck5hbWUgPSAnb25DaGlsZCcgKyBPYmplY3QodXRpbF9bImNhcGl0YWxpemUiXSkoZXZlbnQpOwoKICAgICAgICBpZiAocGFyZW50KSB7CiAgICAgICAgICBmb3IgKHZhciBfbGVuMiA9IGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3MgPSBBcnJheShfbGVuMiA+IDEgPyBfbGVuMiAtIDEgOiAwKSwgX2tleTIgPSAxOyBfa2V5MiA8IF9sZW4yOyBfa2V5MisrKSB7CiAgICAgICAgICAgIGFyZ3NbX2tleTIgLSAxXSA9IGFyZ3VtZW50c1tfa2V5Ml07CiAgICAgICAgICB9CgogICAgICAgICAgcGFyZW50W2hhbmRsZXJOYW1lXSAmJiBwYXJlbnRbaGFuZGxlck5hbWVdLmFwcGx5KHBhcmVudCwgYXJncyk7CiAgICAgICAgICBwYXJlbnQuZW1pdC5hcHBseShwYXJlbnQsIFtldmVudF0uY29uY2F0KGFyZ3MpKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBOb2RlLnByb3RvdHlwZS5vblBhcmVudENoZWNrID0gZnVuY3Rpb24gb25QYXJlbnRDaGVjayhjaGVja2VkKSB7CiAgICAgICAgaWYgKCF0aGlzLmlzRGlzYWJsZWQpIHsKICAgICAgICAgIHRoaXMuc2V0Q2hlY2tTdGF0ZShjaGVja2VkKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBOb2RlLnByb3RvdHlwZS5vbkNoaWxkQ2hlY2sgPSBmdW5jdGlvbiBvbkNoaWxkQ2hlY2soKSB7CiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgICB2YXIgdmFsaWRDaGlsZHJlbiA9IGNoaWxkcmVuLmZpbHRlcihmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgIHJldHVybiAhY2hpbGQuaXNEaXNhYmxlZDsKICAgICAgICB9KTsKICAgICAgICB2YXIgY2hlY2tlZCA9IHZhbGlkQ2hpbGRyZW4ubGVuZ3RoID8gdmFsaWRDaGlsZHJlbi5ldmVyeShmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgIHJldHVybiBjaGlsZC5jaGVja2VkOwogICAgICAgIH0pIDogZmFsc2U7CiAgICAgICAgdGhpcy5zZXRDaGVja1N0YXRlKGNoZWNrZWQpOwogICAgICB9OwoKICAgICAgTm9kZS5wcm90b3R5cGUuc2V0Q2hlY2tTdGF0ZSA9IGZ1bmN0aW9uIHNldENoZWNrU3RhdGUoY2hlY2tlZCkgewogICAgICAgIHZhciB0b3RhbE51bSA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOwogICAgICAgIHZhciBjaGVja2VkTnVtID0gdGhpcy5jaGlsZHJlbi5yZWR1Y2UoZnVuY3Rpb24gKGMsIHApIHsKICAgICAgICAgIHZhciBudW0gPSBwLmNoZWNrZWQgPyAxIDogcC5pbmRldGVybWluYXRlID8gMC41IDogMDsKICAgICAgICAgIHJldHVybiBjICsgbnVtOwogICAgICAgIH0sIDApOwogICAgICAgIHRoaXMuY2hlY2tlZCA9IGNoZWNrZWQ7CiAgICAgICAgdGhpcy5pbmRldGVybWluYXRlID0gY2hlY2tlZE51bSAhPT0gdG90YWxOdW0gJiYgY2hlY2tlZE51bSA+IDA7CiAgICAgIH07CgogICAgICBOb2RlLnByb3RvdHlwZS5zeW5jQ2hlY2tTdGF0ZSA9IGZ1bmN0aW9uIHN5bmNDaGVja1N0YXRlKGNoZWNrZWRWYWx1ZSkgewogICAgICAgIHZhciB2YWx1ZSA9IHRoaXMuZ2V0VmFsdWVCeU9wdGlvbigpOwogICAgICAgIHZhciBjaGVja2VkID0gdGhpcy5pc1NhbWVOb2RlKGNoZWNrZWRWYWx1ZSwgdmFsdWUpOwogICAgICAgIHRoaXMuZG9DaGVjayhjaGVja2VkKTsKICAgICAgfTsKCiAgICAgIE5vZGUucHJvdG90eXBlLmRvQ2hlY2sgPSBmdW5jdGlvbiBkb0NoZWNrKGNoZWNrZWQpIHsKICAgICAgICBpZiAodGhpcy5jaGVja2VkICE9PSBjaGVja2VkKSB7CiAgICAgICAgICBpZiAodGhpcy5jb25maWcuY2hlY2tTdHJpY3RseSkgewogICAgICAgICAgICB0aGlzLmNoZWNrZWQgPSBjaGVja2VkOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gYm90dG9tIHVwIHRvIHVuaWZ5IHRoZSBjYWxjdWxhdGlvbiBvZiB0aGUgaW5kZXRlcm1pbmF0ZSBzdGF0ZQogICAgICAgICAgICB0aGlzLmJyb2FkY2FzdCgnY2hlY2snLCBjaGVja2VkKTsKICAgICAgICAgICAgdGhpcy5zZXRDaGVja1N0YXRlKGNoZWNrZWQpOwogICAgICAgICAgICB0aGlzLmVtaXQoJ2NoZWNrJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwoKICAgICAgX2NyZWF0ZUNsYXNzKE5vZGUsIFt7CiAgICAgICAga2V5OiAnaXNEaXNhYmxlZCcsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YSwKICAgICAgICAgICAgICBwYXJlbnQgPSB0aGlzLnBhcmVudCwKICAgICAgICAgICAgICBjb25maWcgPSB0aGlzLmNvbmZpZzsKICAgICAgICAgIHZhciBkaXNhYmxlZEtleSA9IGNvbmZpZy5kaXNhYmxlZDsKICAgICAgICAgIHZhciBjaGVja1N0cmljdGx5ID0gY29uZmlnLmNoZWNrU3RyaWN0bHk7CiAgICAgICAgICByZXR1cm4gZGF0YVtkaXNhYmxlZEtleV0gfHwgIWNoZWNrU3RyaWN0bHkgJiYgcGFyZW50ICYmIHBhcmVudC5pc0Rpc2FibGVkOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogJ2lzTGVhZicsCiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YSwKICAgICAgICAgICAgICBsb2FkZWQgPSB0aGlzLmxvYWRlZCwKICAgICAgICAgICAgICBoYXNDaGlsZHJlbiA9IHRoaXMuaGFzQ2hpbGRyZW4sCiAgICAgICAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICAgICAgdmFyIF9jb25maWcyID0gdGhpcy5jb25maWcsCiAgICAgICAgICAgICAgbGF6eSA9IF9jb25maWcyLmxhenksCiAgICAgICAgICAgICAgbGVhZktleSA9IF9jb25maWcyLmxlYWY7CgogICAgICAgICAgaWYgKGxhenkpIHsKICAgICAgICAgICAgdmFyIGlzTGVhZiA9IE9iamVjdChzaGFyZWRfWyJpc0RlZiJdKShkYXRhW2xlYWZLZXldKSA/IGRhdGFbbGVhZktleV0gOiBsb2FkZWQgPyAhY2hpbGRyZW4ubGVuZ3RoIDogZmFsc2U7CiAgICAgICAgICAgIHRoaXMuaGFzQ2hpbGRyZW4gPSAhaXNMZWFmOwogICAgICAgICAgICByZXR1cm4gaXNMZWFmOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiAhaGFzQ2hpbGRyZW47CiAgICAgICAgfQogICAgICB9XSk7CgogICAgICByZXR1cm4gTm9kZTsKICAgIH0oKTsKICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8KCgogICAgdmFyIHNyY19ub2RlID0gbm9kZV9Ob2RlOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3BhY2thZ2VzL2Nhc2NhZGVyLXBhbmVsL3NyYy9zdG9yZS5qcwoKICAgIGZ1bmN0aW9uIHN0b3JlX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgICB9CiAgICB9CgogICAgdmFyIGZsYXROb2RlcyA9IGZ1bmN0aW9uIGZsYXROb2RlcyhkYXRhLCBsZWFmT25seSkgewogICAgICByZXR1cm4gZGF0YS5yZWR1Y2UoZnVuY3Rpb24gKHJlcywgbm9kZSkgewogICAgICAgIGlmIChub2RlLmlzTGVhZikgewogICAgICAgICAgcmVzLnB1c2gobm9kZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICFsZWFmT25seSAmJiByZXMucHVzaChub2RlKTsKICAgICAgICAgIHJlcyA9IHJlcy5jb25jYXQoZmxhdE5vZGVzKG5vZGUuY2hpbGRyZW4sIGxlYWZPbmx5KSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzOwogICAgICB9LCBbXSk7CiAgICB9OwoKICAgIHZhciBzdG9yZV9TdG9yZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gU3RvcmUoZGF0YSwgY29uZmlnKSB7CiAgICAgICAgc3RvcmVfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3RvcmUpOwogICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnOwogICAgICAgIHRoaXMuaW5pdE5vZGVzKGRhdGEpOwogICAgICB9CgogICAgICBTdG9yZS5wcm90b3R5cGUuaW5pdE5vZGVzID0gZnVuY3Rpb24gaW5pdE5vZGVzKGRhdGEpIHsKICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICBkYXRhID0gT2JqZWN0KHV0aWxfWyJjb2VyY2VUcnV0aHlWYWx1ZVRvQXJyYXkiXSkoZGF0YSk7CiAgICAgICAgdGhpcy5ub2RlcyA9IGRhdGEubWFwKGZ1bmN0aW9uIChub2RlRGF0YSkgewogICAgICAgICAgcmV0dXJuIG5ldyBzcmNfbm9kZShub2RlRGF0YSwgX3RoaXMuY29uZmlnKTsKICAgICAgICB9KTsKICAgICAgICB0aGlzLmZsYXR0ZWROb2RlcyA9IHRoaXMuZ2V0RmxhdHRlZE5vZGVzKGZhbHNlLCBmYWxzZSk7CiAgICAgICAgdGhpcy5sZWFmTm9kZXMgPSB0aGlzLmdldEZsYXR0ZWROb2Rlcyh0cnVlLCBmYWxzZSk7CiAgICAgIH07CgogICAgICBTdG9yZS5wcm90b3R5cGUuYXBwZW5kTm9kZSA9IGZ1bmN0aW9uIGFwcGVuZE5vZGUobm9kZURhdGEsIHBhcmVudE5vZGUpIHsKICAgICAgICB2YXIgbm9kZSA9IG5ldyBzcmNfbm9kZShub2RlRGF0YSwgdGhpcy5jb25maWcsIHBhcmVudE5vZGUpOwogICAgICAgIHZhciBjaGlsZHJlbiA9IHBhcmVudE5vZGUgPyBwYXJlbnROb2RlLmNoaWxkcmVuIDogdGhpcy5ub2RlczsKICAgICAgICBjaGlsZHJlbi5wdXNoKG5vZGUpOwogICAgICB9OwoKICAgICAgU3RvcmUucHJvdG90eXBlLmFwcGVuZE5vZGVzID0gZnVuY3Rpb24gYXBwZW5kTm9kZXMobm9kZURhdGFMaXN0LCBwYXJlbnROb2RlKSB7CiAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgIG5vZGVEYXRhTGlzdCA9IE9iamVjdCh1dGlsX1siY29lcmNlVHJ1dGh5VmFsdWVUb0FycmF5Il0pKG5vZGVEYXRhTGlzdCk7CiAgICAgICAgbm9kZURhdGFMaXN0LmZvckVhY2goZnVuY3Rpb24gKG5vZGVEYXRhKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMyLmFwcGVuZE5vZGUobm9kZURhdGEsIHBhcmVudE5vZGUpOwogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgU3RvcmUucHJvdG90eXBlLmdldE5vZGVzID0gZnVuY3Rpb24gZ2V0Tm9kZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubm9kZXM7CiAgICAgIH07CgogICAgICBTdG9yZS5wcm90b3R5cGUuZ2V0RmxhdHRlZE5vZGVzID0gZnVuY3Rpb24gZ2V0RmxhdHRlZE5vZGVzKGxlYWZPbmx5KSB7CiAgICAgICAgdmFyIGNhY2hlZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdHJ1ZTsKICAgICAgICB2YXIgY2FjaGVkTm9kZXMgPSBsZWFmT25seSA/IHRoaXMubGVhZk5vZGVzIDogdGhpcy5mbGF0dGVkTm9kZXM7CiAgICAgICAgcmV0dXJuIGNhY2hlZCA/IGNhY2hlZE5vZGVzIDogZmxhdE5vZGVzKHRoaXMubm9kZXMsIGxlYWZPbmx5KTsKICAgICAgfTsKCiAgICAgIFN0b3JlLnByb3RvdHlwZS5nZXROb2RlQnlWYWx1ZSA9IGZ1bmN0aW9uIGdldE5vZGVCeVZhbHVlKHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICB2YXIgbm9kZXMgPSB0aGlzLmdldEZsYXR0ZWROb2RlcyhmYWxzZSwgIXRoaXMuY29uZmlnLmxhenkpLmZpbHRlcihmdW5jdGlvbiAobm9kZSkgewogICAgICAgICAgICByZXR1cm4gT2JqZWN0KHV0aWxfWyJ2YWx1ZUVxdWFscyJdKShub2RlLnBhdGgsIHZhbHVlKSB8fCBub2RlLnZhbHVlID09PSB2YWx1ZTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIG5vZGVzICYmIG5vZGVzLmxlbmd0aCA/IG5vZGVzWzBdIDogbnVsbDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9OwoKICAgICAgcmV0dXJuIFN0b3JlOwogICAgfSgpOwogICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLwoKCiAgICB2YXIgc3JjX3N0b3JlID0gc3RvcmVfU3RvcmU7IC8vIEVYVEVSTkFMIE1PRFVMRTogZXh0ZXJuYWwgImVsZW1lbnQtdWkvbGliL3V0aWxzL21lcmdlIgoKICAgIHZhciBtZXJnZV8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkpOwoKICAgIHZhciBtZXJnZV9kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihtZXJnZV8pOyAvLyBFWFRFUk5BTCBNT0RVTEU6IGV4dGVybmFsICJlbGVtZW50LXVpL2xpYi91dGlscy9hcmlhLXV0aWxzIgoKCiAgICB2YXIgYXJpYV91dGlsc18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQwKTsKCiAgICB2YXIgYXJpYV91dGlsc19kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihhcmlhX3V0aWxzXyk7IC8vIEVYVEVSTkFMIE1PRFVMRTogZXh0ZXJuYWwgImVsZW1lbnQtdWkvbGliL3V0aWxzL3Njcm9sbC1pbnRvLXZpZXciCgoKICAgIHZhciBzY3JvbGxfaW50b192aWV3XyA9IF9fd2VicGFja19yZXF1aXJlX18oMzEpOwoKICAgIHZhciBzY3JvbGxfaW50b192aWV3X2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy5uKHNjcm9sbF9pbnRvX3ZpZXdfKTsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvYmFiZWwtbG9hZGVyL2xpYiEuL25vZGVfbW9kdWxlcy92dWUtbG9hZGVyL2xpYj8/dnVlLWxvYWRlci1vcHRpb25zIS4vcGFja2FnZXMvY2FzY2FkZXItcGFuZWwvc3JjL2Nhc2NhZGVyLXBhbmVsLnZ1ZT92dWUmdHlwZT1zY3JpcHQmbGFuZz1qcyYKCgogICAgdmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsKICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9OyAvLwogICAgLy8KICAgIC8vCiAgICAvLwogICAgLy8KICAgIC8vCiAgICAvLwogICAgLy8KICAgIC8vCiAgICAvLwogICAgLy8KICAgIC8vCiAgICAvLwogICAgLy8KICAgIC8vCiAgICAvLwoKCiAgICB2YXIgS2V5Q29kZSA9IGFyaWFfdXRpbHNfZGVmYXVsdC5hLmtleXM7CiAgICB2YXIgRGVmYXVsdFByb3BzID0gewogICAgICBleHBhbmRUcmlnZ2VyOiAnY2xpY2snLAogICAgICAvLyBvciBob3ZlcgogICAgICBtdWx0aXBsZTogZmFsc2UsCiAgICAgIGNoZWNrU3RyaWN0bHk6IGZhbHNlLAogICAgICAvLyB3aGV0aGVyIGFsbCBub2RlcyBjYW4gYmUgc2VsZWN0ZWQKICAgICAgZW1pdFBhdGg6IHRydWUsCiAgICAgIC8vIHdldGhlciB0byBlbWl0IGFuIGFycmF5IG9mIGFsbCBsZXZlbHMgdmFsdWUgaW4gd2hpY2ggbm9kZSBpcyBsb2NhdGVkCiAgICAgIGxhenk6IGZhbHNlLAogICAgICBsYXp5TG9hZDogdXRpbF9bIm5vb3AiXSwKICAgICAgdmFsdWU6ICd2YWx1ZScsCiAgICAgIGxhYmVsOiAnbGFiZWwnLAogICAgICBjaGlsZHJlbjogJ2NoaWxkcmVuJywKICAgICAgbGVhZjogJ2xlYWYnLAogICAgICBkaXNhYmxlZDogJ2Rpc2FibGVkJywKICAgICAgaG92ZXJUaHJlc2hvbGQ6IDUwMAogICAgfTsKCiAgICB2YXIgY2FzY2FkZXJfcGFuZWx2dWVfdHlwZV9zY3JpcHRfbGFuZ19qc19pc0xlYWYgPSBmdW5jdGlvbiBpc0xlYWYoZWwpIHsKICAgICAgcmV0dXJuICFlbC5nZXRBdHRyaWJ1dGUoJ2FyaWEtb3ducycpOwogICAgfTsKCiAgICB2YXIgZ2V0U2libGluZyA9IGZ1bmN0aW9uIGdldFNpYmxpbmcoZWwsIGRpc3RhbmNlKSB7CiAgICAgIHZhciBwYXJlbnROb2RlID0gZWwucGFyZW50Tm9kZTsKCiAgICAgIGlmIChwYXJlbnROb2RlKSB7CiAgICAgICAgdmFyIHNpYmxpbmdzID0gcGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yQWxsKCcuZWwtY2FzY2FkZXItbm9kZVt0YWJpbmRleD0iLTEiXScpOwogICAgICAgIHZhciBpbmRleCA9IEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoc2libGluZ3MsIGVsKTsKICAgICAgICByZXR1cm4gc2libGluZ3NbaW5kZXggKyBkaXN0YW5jZV0gfHwgbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwoKICAgIHZhciBnZXRNZW51SW5kZXggPSBmdW5jdGlvbiBnZXRNZW51SW5kZXgoZWwsIGRpc3RhbmNlKSB7CiAgICAgIGlmICghZWwpIHJldHVybjsKICAgICAgdmFyIHBpZWNlcyA9IGVsLmlkLnNwbGl0KCctJyk7CiAgICAgIHJldHVybiBOdW1iZXIocGllY2VzW3BpZWNlcy5sZW5ndGggLSAyXSk7CiAgICB9OwoKICAgIHZhciBmb2N1c05vZGUgPSBmdW5jdGlvbiBmb2N1c05vZGUoZWwpIHsKICAgICAgaWYgKCFlbCkgcmV0dXJuOwogICAgICBlbC5mb2N1cygpOwogICAgICAhY2FzY2FkZXJfcGFuZWx2dWVfdHlwZV9zY3JpcHRfbGFuZ19qc19pc0xlYWYoZWwpICYmIGVsLmNsaWNrKCk7CiAgICB9OwoKICAgIHZhciBjaGVja05vZGUgPSBmdW5jdGlvbiBjaGVja05vZGUoZWwpIHsKICAgICAgaWYgKCFlbCkgcmV0dXJuOwogICAgICB2YXIgaW5wdXQgPSBlbC5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpOwoKICAgICAgaWYgKGlucHV0KSB7CiAgICAgICAgaW5wdXQuY2xpY2soKTsKICAgICAgfSBlbHNlIGlmIChjYXNjYWRlcl9wYW5lbHZ1ZV90eXBlX3NjcmlwdF9sYW5nX2pzX2lzTGVhZihlbCkpIHsKICAgICAgICBlbC5jbGljaygpOwogICAgICB9CiAgICB9OwogICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLwoKCiAgICB2YXIgY2FzY2FkZXJfcGFuZWx2dWVfdHlwZV9zY3JpcHRfbGFuZ19qc18gPSB7CiAgICAgIG5hbWU6ICdFbENhc2NhZGVyUGFuZWwnLAogICAgICBjb21wb25lbnRzOiB7CiAgICAgICAgQ2FzY2FkZXJNZW51OiBjYXNjYWRlcl9tZW51CiAgICAgIH0sCiAgICAgIHByb3BzOiB7CiAgICAgICAgdmFsdWU6IHt9LAogICAgICAgIG9wdGlvbnM6IEFycmF5LAogICAgICAgIHByb3BzOiBPYmplY3QsCiAgICAgICAgYm9yZGVyOiB7CiAgICAgICAgICB0eXBlOiBCb29sZWFuLAogICAgICAgICAgZGVmYXVsdDogdHJ1ZQogICAgICAgIH0sCiAgICAgICAgcmVuZGVyTGFiZWw6IEZ1bmN0aW9uCiAgICAgIH0sCiAgICAgIHByb3ZpZGU6IGZ1bmN0aW9uIHByb3ZpZGUoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHBhbmVsOiB0aGlzCiAgICAgICAgfTsKICAgICAgfSwKICAgICAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgY2hlY2tlZFZhbHVlOiBudWxsLAogICAgICAgICAgY2hlY2tlZE5vZGVQYXRoczogW10sCiAgICAgICAgICBzdG9yZTogW10sCiAgICAgICAgICBtZW51czogW10sCiAgICAgICAgICBhY3RpdmVQYXRoOiBbXSwKICAgICAgICAgIGxvYWRDb3VudDogMAogICAgICAgIH07CiAgICAgIH0sCiAgICAgIGNvbXB1dGVkOiB7CiAgICAgICAgY29uZmlnOiBmdW5jdGlvbiBjb25maWcoKSB7CiAgICAgICAgICByZXR1cm4gbWVyZ2VfZGVmYXVsdCgpKF9leHRlbmRzKHt9LCBEZWZhdWx0UHJvcHMpLCB0aGlzLnByb3BzIHx8IHt9KTsKICAgICAgICB9LAogICAgICAgIG11bHRpcGxlOiBmdW5jdGlvbiBtdWx0aXBsZSgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmNvbmZpZy5tdWx0aXBsZTsKICAgICAgICB9LAogICAgICAgIGNoZWNrU3RyaWN0bHk6IGZ1bmN0aW9uIGNoZWNrU3RyaWN0bHkoKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5jb25maWcuY2hlY2tTdHJpY3RseTsKICAgICAgICB9LAogICAgICAgIGxlYWZPbmx5OiBmdW5jdGlvbiBsZWFmT25seSgpIHsKICAgICAgICAgIHJldHVybiAhdGhpcy5jaGVja1N0cmljdGx5OwogICAgICAgIH0sCiAgICAgICAgaXNIb3Zlck1lbnU6IGZ1bmN0aW9uIGlzSG92ZXJNZW51KCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlnLmV4cGFuZFRyaWdnZXIgPT09ICdob3Zlcic7CiAgICAgICAgfSwKICAgICAgICByZW5kZXJMYWJlbEZuOiBmdW5jdGlvbiByZW5kZXJMYWJlbEZuKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyTGFiZWwgfHwgdGhpcy4kc2NvcGVkU2xvdHMuZGVmYXVsdDsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHdhdGNoOiB7CiAgICAgICAgb3B0aW9uczogewogICAgICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcigpIHsKICAgICAgICAgICAgdGhpcy5pbml0U3RvcmUoKTsKICAgICAgICAgIH0sCiAgICAgICAgICBpbW1lZGlhdGU6IHRydWUsCiAgICAgICAgICBkZWVwOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICB0aGlzLnN5bmNDaGVja2VkVmFsdWUoKTsKICAgICAgICAgIHRoaXMuY2hlY2tTdHJpY3RseSAmJiB0aGlzLmNhbGN1bGF0ZUNoZWNrZWROb2RlUGF0aHMoKTsKICAgICAgICB9LAogICAgICAgIGNoZWNrZWRWYWx1ZTogZnVuY3Rpb24gY2hlY2tlZFZhbHVlKHZhbCkgewogICAgICAgICAgaWYgKCFPYmplY3QodXRpbF9bImlzRXF1YWwiXSkodmFsLCB0aGlzLnZhbHVlKSkgewogICAgICAgICAgICB0aGlzLmNoZWNrU3RyaWN0bHkgJiYgdGhpcy5jYWxjdWxhdGVDaGVja2VkTm9kZVBhdGhzKCk7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2lucHV0JywgdmFsKTsKICAgICAgICAgICAgdGhpcy4kZW1pdCgnY2hhbmdlJywgdmFsKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICAgICAgaWYgKCFPYmplY3QodXRpbF9bImlzRW1wdHkiXSkodGhpcy52YWx1ZSkpIHsKICAgICAgICAgIHRoaXMuc3luY0NoZWNrZWRWYWx1ZSgpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbWV0aG9kczogewogICAgICAgIGluaXRTdG9yZTogZnVuY3Rpb24gaW5pdFN0b3JlKCkgewogICAgICAgICAgdmFyIGNvbmZpZyA9IHRoaXMuY29uZmlnLAogICAgICAgICAgICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7CgogICAgICAgICAgaWYgKGNvbmZpZy5sYXp5ICYmIE9iamVjdCh1dGlsX1siaXNFbXB0eSJdKShvcHRpb25zKSkgewogICAgICAgICAgICB0aGlzLmxhenlMb2FkKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnN0b3JlID0gbmV3IHNyY19zdG9yZShvcHRpb25zLCBjb25maWcpOwogICAgICAgICAgICB0aGlzLm1lbnVzID0gW3RoaXMuc3RvcmUuZ2V0Tm9kZXMoKV07CiAgICAgICAgICAgIHRoaXMuc3luY01lbnVTdGF0ZSgpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3luY0NoZWNrZWRWYWx1ZTogZnVuY3Rpb24gc3luY0NoZWNrZWRWYWx1ZSgpIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IHRoaXMudmFsdWUsCiAgICAgICAgICAgICAgY2hlY2tlZFZhbHVlID0gdGhpcy5jaGVja2VkVmFsdWU7CgogICAgICAgICAgaWYgKCFPYmplY3QodXRpbF9bImlzRXF1YWwiXSkodmFsdWUsIGNoZWNrZWRWYWx1ZSkpIHsKICAgICAgICAgICAgdGhpcy5hY3RpdmVQYXRoID0gW107CiAgICAgICAgICAgIHRoaXMuY2hlY2tlZFZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgIHRoaXMuc3luY01lbnVTdGF0ZSgpOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc3luY01lbnVTdGF0ZTogZnVuY3Rpb24gc3luY01lbnVTdGF0ZSgpIHsKICAgICAgICAgIHZhciBtdWx0aXBsZSA9IHRoaXMubXVsdGlwbGUsCiAgICAgICAgICAgICAgY2hlY2tTdHJpY3RseSA9IHRoaXMuY2hlY2tTdHJpY3RseTsKICAgICAgICAgIHRoaXMuc3luY0FjdGl2ZVBhdGgoKTsKICAgICAgICAgIG11bHRpcGxlICYmIHRoaXMuc3luY011bHRpQ2hlY2tTdGF0ZSgpOwogICAgICAgICAgY2hlY2tTdHJpY3RseSAmJiB0aGlzLmNhbGN1bGF0ZUNoZWNrZWROb2RlUGF0aHMoKTsKICAgICAgICAgIHRoaXMuJG5leHRUaWNrKHRoaXMuc2Nyb2xsSW50b1ZpZXcpOwogICAgICAgIH0sCiAgICAgICAgc3luY011bHRpQ2hlY2tTdGF0ZTogZnVuY3Rpb24gc3luY011bHRpQ2hlY2tTdGF0ZSgpIHsKICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgICAgdmFyIG5vZGVzID0gdGhpcy5nZXRGbGF0dGVkTm9kZXModGhpcy5sZWFmT25seSk7CiAgICAgICAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICAgIG5vZGUuc3luY0NoZWNrU3RhdGUoX3RoaXMuY2hlY2tlZFZhbHVlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgc3luY0FjdGl2ZVBhdGg6IGZ1bmN0aW9uIHN5bmNBY3RpdmVQYXRoKCkgewogICAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgICAgdmFyIHN0b3JlID0gdGhpcy5zdG9yZSwKICAgICAgICAgICAgICBtdWx0aXBsZSA9IHRoaXMubXVsdGlwbGUsCiAgICAgICAgICAgICAgYWN0aXZlUGF0aCA9IHRoaXMuYWN0aXZlUGF0aCwKICAgICAgICAgICAgICBjaGVja2VkVmFsdWUgPSB0aGlzLmNoZWNrZWRWYWx1ZTsKCiAgICAgICAgICBpZiAoIU9iamVjdCh1dGlsX1siaXNFbXB0eSJdKShhY3RpdmVQYXRoKSkgewogICAgICAgICAgICB2YXIgbm9kZXMgPSBhY3RpdmVQYXRoLm1hcChmdW5jdGlvbiAobm9kZSkgewogICAgICAgICAgICAgIHJldHVybiBfdGhpczIuZ2V0Tm9kZUJ5VmFsdWUobm9kZS5nZXRWYWx1ZSgpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuZXhwYW5kTm9kZXMobm9kZXMpOwogICAgICAgICAgfSBlbHNlIGlmICghT2JqZWN0KHV0aWxfWyJpc0VtcHR5Il0pKGNoZWNrZWRWYWx1ZSkpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gbXVsdGlwbGUgPyBjaGVja2VkVmFsdWVbMF0gOiBjaGVja2VkVmFsdWU7CiAgICAgICAgICAgIHZhciBjaGVja2VkTm9kZSA9IHRoaXMuZ2V0Tm9kZUJ5VmFsdWUodmFsdWUpIHx8IHt9OwoKICAgICAgICAgICAgdmFyIF9ub2RlcyA9IChjaGVja2VkTm9kZS5wYXRoTm9kZXMgfHwgW10pLnNsaWNlKDAsIC0xKTsKCiAgICAgICAgICAgIHRoaXMuZXhwYW5kTm9kZXMoX25vZGVzKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuYWN0aXZlUGF0aCA9IFtdOwogICAgICAgICAgICB0aGlzLm1lbnVzID0gW3N0b3JlLmdldE5vZGVzKCldOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZXhwYW5kTm9kZXM6IGZ1bmN0aW9uIGV4cGFuZE5vZGVzKG5vZGVzKSB7CiAgICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgICBub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpczMuaGFuZGxlRXhwYW5kKG5vZGUsIHRydWUKICAgICAgICAgICAgLyogc2lsZW50ICovCiAgICAgICAgICAgICk7CiAgICAgICAgICB9KTsKICAgICAgICB9LAogICAgICAgIGNhbGN1bGF0ZUNoZWNrZWROb2RlUGF0aHM6IGZ1bmN0aW9uIGNhbGN1bGF0ZUNoZWNrZWROb2RlUGF0aHMoKSB7CiAgICAgICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgICAgICB2YXIgY2hlY2tlZFZhbHVlID0gdGhpcy5jaGVja2VkVmFsdWUsCiAgICAgICAgICAgICAgbXVsdGlwbGUgPSB0aGlzLm11bHRpcGxlOwogICAgICAgICAgdmFyIGNoZWNrZWRWYWx1ZXMgPSBtdWx0aXBsZSA/IE9iamVjdCh1dGlsX1siY29lcmNlVHJ1dGh5VmFsdWVUb0FycmF5Il0pKGNoZWNrZWRWYWx1ZSkgOiBbY2hlY2tlZFZhbHVlXTsKICAgICAgICAgIHRoaXMuY2hlY2tlZE5vZGVQYXRocyA9IGNoZWNrZWRWYWx1ZXMubWFwKGZ1bmN0aW9uICh2KSB7CiAgICAgICAgICAgIHZhciBjaGVja2VkTm9kZSA9IF90aGlzNC5nZXROb2RlQnlWYWx1ZSh2KTsKCiAgICAgICAgICAgIHJldHVybiBjaGVja2VkTm9kZSA/IGNoZWNrZWROb2RlLnBhdGhOb2RlcyA6IFtdOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBoYW5kbGVLZXlEb3duOiBmdW5jdGlvbiBoYW5kbGVLZXlEb3duKGUpIHsKICAgICAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldCwKICAgICAgICAgICAgICBrZXlDb2RlID0gZS5rZXlDb2RlOwoKICAgICAgICAgIHN3aXRjaCAoa2V5Q29kZSkgewogICAgICAgICAgICBjYXNlIEtleUNvZGUudXA6CiAgICAgICAgICAgICAgdmFyIHByZXYgPSBnZXRTaWJsaW5nKHRhcmdldCwgLTEpOwogICAgICAgICAgICAgIGZvY3VzTm9kZShwcmV2KTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgS2V5Q29kZS5kb3duOgogICAgICAgICAgICAgIHZhciBuZXh0ID0gZ2V0U2libGluZyh0YXJnZXQsIDEpOwogICAgICAgICAgICAgIGZvY3VzTm9kZShuZXh0KTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgS2V5Q29kZS5sZWZ0OgogICAgICAgICAgICAgIHZhciBwcmVNZW51ID0gdGhpcy4kcmVmcy5tZW51W2dldE1lbnVJbmRleCh0YXJnZXQpIC0gMV07CgogICAgICAgICAgICAgIGlmIChwcmVNZW51KSB7CiAgICAgICAgICAgICAgICB2YXIgZXhwYW5kZWROb2RlID0gcHJlTWVudS4kZWwucXVlcnlTZWxlY3RvcignLmVsLWNhc2NhZGVyLW5vZGVbYXJpYS1leHBhbmRlZD0idHJ1ZSJdJyk7CiAgICAgICAgICAgICAgICBmb2N1c05vZGUoZXhwYW5kZWROb2RlKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBLZXlDb2RlLnJpZ2h0OgogICAgICAgICAgICAgIHZhciBuZXh0TWVudSA9IHRoaXMuJHJlZnMubWVudVtnZXRNZW51SW5kZXgodGFyZ2V0KSArIDFdOwoKICAgICAgICAgICAgICBpZiAobmV4dE1lbnUpIHsKICAgICAgICAgICAgICAgIHZhciBmaXJzdE5vZGUgPSBuZXh0TWVudS4kZWwucXVlcnlTZWxlY3RvcignLmVsLWNhc2NhZGVyLW5vZGVbdGFiaW5kZXg9Ii0xIl0nKTsKICAgICAgICAgICAgICAgIGZvY3VzTm9kZShmaXJzdE5vZGUpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIEtleUNvZGUuZW50ZXI6CiAgICAgICAgICAgICAgY2hlY2tOb2RlKHRhcmdldCk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIEtleUNvZGUuZXNjOgogICAgICAgICAgICBjYXNlIEtleUNvZGUudGFiOgogICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2Nsb3NlJyk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGhhbmRsZUV4cGFuZDogZnVuY3Rpb24gaGFuZGxlRXhwYW5kKG5vZGUsIHNpbGVudCkgewogICAgICAgICAgdmFyIGFjdGl2ZVBhdGggPSB0aGlzLmFjdGl2ZVBhdGg7CiAgICAgICAgICB2YXIgbGV2ZWwgPSBub2RlLmxldmVsOwogICAgICAgICAgdmFyIHBhdGggPSBhY3RpdmVQYXRoLnNsaWNlKDAsIGxldmVsIC0gMSk7CiAgICAgICAgICB2YXIgbWVudXMgPSB0aGlzLm1lbnVzLnNsaWNlKDAsIGxldmVsKTsKCiAgICAgICAgICBpZiAoIW5vZGUuaXNMZWFmKSB7CiAgICAgICAgICAgIHBhdGgucHVzaChub2RlKTsKICAgICAgICAgICAgbWVudXMucHVzaChub2RlLmNoaWxkcmVuKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmFjdGl2ZVBhdGggPSBwYXRoOwogICAgICAgICAgdGhpcy5tZW51cyA9IG1lbnVzOwoKICAgICAgICAgIGlmICghc2lsZW50KSB7CiAgICAgICAgICAgIHZhciBwYXRoVmFsdWVzID0gcGF0aC5tYXAoZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAgICAgICByZXR1cm4gbm9kZS5nZXRWYWx1ZSgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGFjdGl2ZVBhdGhWYWx1ZXMgPSBhY3RpdmVQYXRoLm1hcChmdW5jdGlvbiAobm9kZSkgewogICAgICAgICAgICAgIHJldHVybiBub2RlLmdldFZhbHVlKCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKCFPYmplY3QodXRpbF9bInZhbHVlRXF1YWxzIl0pKHBhdGhWYWx1ZXMsIGFjdGl2ZVBhdGhWYWx1ZXMpKSB7CiAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnYWN0aXZlLWl0ZW0tY2hhbmdlJywgcGF0aFZhbHVlcyk7IC8vIERlcHJlY2F0ZWQKCiAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnZXhwYW5kLWNoYW5nZScsIHBhdGhWYWx1ZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBoYW5kbGVDaGVja0NoYW5nZTogZnVuY3Rpb24gaGFuZGxlQ2hlY2tDaGFuZ2UodmFsdWUpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZFZhbHVlID0gdmFsdWU7CiAgICAgICAgfSwKICAgICAgICBsYXp5TG9hZDogZnVuY3Rpb24gbGF6eUxvYWQobm9kZSwgb25GdWxsZmlsZWQpIHsKICAgICAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgICAgIHZhciBjb25maWcgPSB0aGlzLmNvbmZpZzsKCiAgICAgICAgICBpZiAoIW5vZGUpIHsKICAgICAgICAgICAgbm9kZSA9IG5vZGUgfHwgewogICAgICAgICAgICAgIHJvb3Q6IHRydWUsCiAgICAgICAgICAgICAgbGV2ZWw6IDAKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5zdG9yZSA9IG5ldyBzcmNfc3RvcmUoW10sIGNvbmZpZyk7CiAgICAgICAgICAgIHRoaXMubWVudXMgPSBbdGhpcy5zdG9yZS5nZXROb2RlcygpXTsKICAgICAgICAgIH0KCiAgICAgICAgICBub2RlLmxvYWRpbmcgPSB0cnVlOwoKICAgICAgICAgIHZhciByZXNvbHZlID0gZnVuY3Rpb24gcmVzb2x2ZShkYXRhTGlzdCkgewogICAgICAgICAgICB2YXIgcGFyZW50ID0gbm9kZS5yb290ID8gbnVsbCA6IG5vZGU7CiAgICAgICAgICAgIGRhdGFMaXN0ICYmIGRhdGFMaXN0Lmxlbmd0aCAmJiBfdGhpczUuc3RvcmUuYXBwZW5kTm9kZXMoZGF0YUxpc3QsIHBhcmVudCk7CiAgICAgICAgICAgIG5vZGUubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICBub2RlLmxvYWRlZCA9IHRydWU7IC8vIGRpc3Bvc2UgZGVmYXVsdCB2YWx1ZSBvbiBsYXp5IGxvYWQgbW9kZQoKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoX3RoaXM1LmNoZWNrZWRWYWx1ZSkpIHsKICAgICAgICAgICAgICB2YXIgbm9kZVZhbHVlID0gX3RoaXM1LmNoZWNrZWRWYWx1ZVtfdGhpczUubG9hZENvdW50KytdOwogICAgICAgICAgICAgIHZhciB2YWx1ZUtleSA9IF90aGlzNS5jb25maWcudmFsdWU7CiAgICAgICAgICAgICAgdmFyIGxlYWZLZXkgPSBfdGhpczUuY29uZmlnLmxlYWY7CgogICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGFMaXN0KSAmJiBkYXRhTGlzdC5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIHJldHVybiBpdGVtW3ZhbHVlS2V5XSA9PT0gbm9kZVZhbHVlOwogICAgICAgICAgICAgIH0pLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHZhciBjaGVja2VkTm9kZSA9IF90aGlzNS5zdG9yZS5nZXROb2RlQnlWYWx1ZShub2RlVmFsdWUpOwoKICAgICAgICAgICAgICAgIGlmICghY2hlY2tlZE5vZGUuZGF0YVtsZWFmS2V5XSkgewogICAgICAgICAgICAgICAgICBfdGhpczUubGF6eUxvYWQoY2hlY2tlZE5vZGUsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpczUuaGFuZGxlRXhwYW5kKGNoZWNrZWROb2RlKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKF90aGlzNS5sb2FkQ291bnQgPT09IF90aGlzNS5jaGVja2VkVmFsdWUubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIF90aGlzNS4kcGFyZW50LmNvbXB1dGVQcmVzZW50VGV4dCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgb25GdWxsZmlsZWQgJiYgb25GdWxsZmlsZWQoZGF0YUxpc3QpOwogICAgICAgICAgfTsKCiAgICAgICAgICBjb25maWcubGF6eUxvYWQobm9kZSwgcmVzb2x2ZSk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogcHVibGljIG1ldGhvZHMKICAgICAgICAqLwogICAgICAgIGNhbGN1bGF0ZU11bHRpQ2hlY2tlZFZhbHVlOiBmdW5jdGlvbiBjYWxjdWxhdGVNdWx0aUNoZWNrZWRWYWx1ZSgpIHsKICAgICAgICAgIHRoaXMuY2hlY2tlZFZhbHVlID0gdGhpcy5nZXRDaGVja2VkTm9kZXModGhpcy5sZWFmT25seSkubWFwKGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICAgIHJldHVybiBub2RlLmdldFZhbHVlQnlPcHRpb24oKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgc2Nyb2xsSW50b1ZpZXc6IGZ1bmN0aW9uIHNjcm9sbEludG9WaWV3KCkgewogICAgICAgICAgaWYgKHRoaXMuJGlzU2VydmVyKSByZXR1cm47CiAgICAgICAgICB2YXIgbWVudXMgPSB0aGlzLiRyZWZzLm1lbnUgfHwgW107CiAgICAgICAgICBtZW51cy5mb3JFYWNoKGZ1bmN0aW9uIChtZW51KSB7CiAgICAgICAgICAgIHZhciBtZW51RWxlbWVudCA9IG1lbnUuJGVsOwoKICAgICAgICAgICAgaWYgKG1lbnVFbGVtZW50KSB7CiAgICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IG1lbnVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lbC1zY3JvbGxiYXJfX3dyYXAnKTsKICAgICAgICAgICAgICB2YXIgYWN0aXZlTm9kZSA9IG1lbnVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lbC1jYXNjYWRlci1ub2RlLmlzLWFjdGl2ZScpIHx8IG1lbnVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lbC1jYXNjYWRlci1ub2RlLmluLWFjdGl2ZS1wYXRoJyk7CiAgICAgICAgICAgICAgc2Nyb2xsX2ludG9fdmlld19kZWZhdWx0KCkoY29udGFpbmVyLCBhY3RpdmVOb2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBnZXROb2RlQnlWYWx1ZTogZnVuY3Rpb24gZ2V0Tm9kZUJ5VmFsdWUodmFsKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5zdG9yZS5nZXROb2RlQnlWYWx1ZSh2YWwpOwogICAgICAgIH0sCiAgICAgICAgZ2V0RmxhdHRlZE5vZGVzOiBmdW5jdGlvbiBnZXRGbGF0dGVkTm9kZXMobGVhZk9ubHkpIHsKICAgICAgICAgIHZhciBjYWNoZWQgPSAhdGhpcy5jb25maWcubGF6eTsKICAgICAgICAgIHJldHVybiB0aGlzLnN0b3JlLmdldEZsYXR0ZWROb2RlcyhsZWFmT25seSwgY2FjaGVkKTsKICAgICAgICB9LAogICAgICAgIGdldENoZWNrZWROb2RlczogZnVuY3Rpb24gZ2V0Q2hlY2tlZE5vZGVzKGxlYWZPbmx5KSB7CiAgICAgICAgICB2YXIgY2hlY2tlZFZhbHVlID0gdGhpcy5jaGVja2VkVmFsdWUsCiAgICAgICAgICAgICAgbXVsdGlwbGUgPSB0aGlzLm11bHRpcGxlOwoKICAgICAgICAgIGlmIChtdWx0aXBsZSkgewogICAgICAgICAgICB2YXIgbm9kZXMgPSB0aGlzLmdldEZsYXR0ZWROb2RlcyhsZWFmT25seSk7CiAgICAgICAgICAgIHJldHVybiBub2Rlcy5maWx0ZXIoZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAgICAgICByZXR1cm4gbm9kZS5jaGVja2VkOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QodXRpbF9bImlzRW1wdHkiXSkoY2hlY2tlZFZhbHVlKSA/IFtdIDogW3RoaXMuZ2V0Tm9kZUJ5VmFsdWUoY2hlY2tlZFZhbHVlKV07CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjbGVhckNoZWNrZWROb2RlczogZnVuY3Rpb24gY2xlYXJDaGVja2VkTm9kZXMoKSB7CiAgICAgICAgICB2YXIgY29uZmlnID0gdGhpcy5jb25maWcsCiAgICAgICAgICAgICAgbGVhZk9ubHkgPSB0aGlzLmxlYWZPbmx5OwogICAgICAgICAgdmFyIG11bHRpcGxlID0gY29uZmlnLm11bHRpcGxlLAogICAgICAgICAgICAgIGVtaXRQYXRoID0gY29uZmlnLmVtaXRQYXRoOwoKICAgICAgICAgIGlmIChtdWx0aXBsZSkgewogICAgICAgICAgICB0aGlzLmdldENoZWNrZWROb2RlcyhsZWFmT25seSkuZmlsdGVyKGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICAgICAgcmV0dXJuICFub2RlLmlzRGlzYWJsZWQ7CiAgICAgICAgICAgIH0pLmZvckVhY2goZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICAgICAgICByZXR1cm4gbm9kZS5kb0NoZWNrKGZhbHNlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuY2FsY3VsYXRlTXVsdGlDaGVja2VkVmFsdWUoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tlZFZhbHVlID0gZW1pdFBhdGggPyBbXSA6IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9OyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3BhY2thZ2VzL2Nhc2NhZGVyLXBhbmVsL3NyYy9jYXNjYWRlci1wYW5lbC52dWU/dnVlJnR5cGU9c2NyaXB0Jmxhbmc9anMmCgogICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLwoKICAgIHZhciBzcmNfY2FzY2FkZXJfcGFuZWx2dWVfdHlwZV9zY3JpcHRfbGFuZ19qc18gPSBjYXNjYWRlcl9wYW5lbHZ1ZV90eXBlX3NjcmlwdF9sYW5nX2pzXzsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9wYWNrYWdlcy9jYXNjYWRlci1wYW5lbC9zcmMvY2FzY2FkZXItcGFuZWwudnVlCgogICAgLyogbm9ybWFsaXplIGNvbXBvbmVudCAqLwoKICAgIHZhciBjYXNjYWRlcl9wYW5lbF9jb21wb25lbnQgPSBPYmplY3QoY29tcG9uZW50Tm9ybWFsaXplclsiYSIKICAgIC8qIGRlZmF1bHQgKi8KICAgIF0pKHNyY19jYXNjYWRlcl9wYW5lbHZ1ZV90eXBlX3NjcmlwdF9sYW5nX2pzXywgY2FzY2FkZXJfcGFuZWx2dWVfdHlwZV90ZW1wbGF0ZV9pZF8zNDkzMjM0Nl9yZW5kZXIsIHN0YXRpY1JlbmRlckZucywgZmFsc2UsIG51bGwsIG51bGwsIG51bGwpOwogICAgLyogaG90IHJlbG9hZCAqLwoKICAgIGlmIChmYWxzZSkgewogICAgICB2YXIgY2FzY2FkZXJfcGFuZWxfYXBpOwogICAgfQoKICAgIGNhc2NhZGVyX3BhbmVsX2NvbXBvbmVudC5vcHRpb25zLl9fZmlsZSA9ICJwYWNrYWdlcy9jYXNjYWRlci1wYW5lbC9zcmMvY2FzY2FkZXItcGFuZWwudnVlIjsKICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi8KCiAgICB2YXIgY2FzY2FkZXJfcGFuZWwgPSBjYXNjYWRlcl9wYW5lbF9jb21wb25lbnQuZXhwb3J0czsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9wYWNrYWdlcy9jYXNjYWRlci1wYW5lbC9pbmRleC5qcwoKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgogICAgY2FzY2FkZXJfcGFuZWwuaW5zdGFsbCA9IGZ1bmN0aW9uIChWdWUpIHsKICAgICAgVnVlLmNvbXBvbmVudChjYXNjYWRlcl9wYW5lbC5uYW1lLCBjYXNjYWRlcl9wYW5lbCk7CiAgICB9OwogICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqLwoKCiAgICB2YXIgcGFja2FnZXNfY2FzY2FkZXJfcGFuZWwgPSBfX3dlYnBhY2tfZXhwb3J0c19fWyJkZWZhdWx0Il0gPSBjYXNjYWRlcl9wYW5lbDsKICAgIC8qKiovCiAgfSwKCiAgLyoqKi8KICA2OgogIC8qKiovCiAgZnVuY3Rpb24gXyhtb2R1bGUsIGV4cG9ydHMpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgiZWxlbWVudC11aS9saWIvbWl4aW5zL2xvY2FsZSIpOwogICAgLyoqKi8KICB9LAoKICAvKioqLwogIDk6CiAgLyoqKi8KICBmdW5jdGlvbiBfKG1vZHVsZSwgZXhwb3J0cykgewogICAgbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCJlbGVtZW50LXVpL2xpYi91dGlscy9tZXJnZSIpOwogICAgLyoqKi8KICB9CiAgLyoqKioqKi8KCn0pOw=="},null]}