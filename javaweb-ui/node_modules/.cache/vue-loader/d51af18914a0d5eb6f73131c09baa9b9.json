{"remainingRequest":"D:\\JavaWebVue\\javaweb-ui\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\JavaWebVue\\javaweb-ui\\src\\views\\system\\itemcate\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\JavaWebVue\\javaweb-ui\\src\\views\\system\\itemcate\\index.vue","mtime":1620716888000},{"path":"D:\\JavaWebVue\\javaweb-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\JavaWebVue\\javaweb-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\JavaWebVue\\javaweb-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\JavaWebVue\\javaweb-ui\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgdXBsb2FkSW1hZ2UgZnJvbSAnQC9jb21wb25lbnRzL3VwbG9hZEltYWdlJw0KaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gInZ1ZXgiOw0KZXhwb3J0IGRlZmF1bHQgew0KICBuYW1lOiAiU3lzSXRlbUNhdGUiLA0KICBjb21wb25lbnRzOiB7dXBsb2FkSW1hZ2V9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICBsb2FkaW5nOiB0cnVlLCAgLy8g5Yqg6L2954q25oCBDQogICAgICBkYXRhOiBbXSwgIC8vIOWIl+ihqOaVsOaNrg0KICAgICAgd2hlcmU6IHt9LCAgLy8g5pCc57Si5p2h5Lu2DQogICAgICBzaG93RWRpdDogZmFsc2UsICAvLyDmmK/lkKbmmL7npLrooajljZXlvLnnqpcNCiAgICAgIGZvcm06IHt9LCAgLy8g6KGo5Y2V5pWw5o2uDQogICAgICBydWxlczogeyAgLy8g6KGo5Y2V6aqM6K+B6KeE5YiZDQogICAgICAgIG5hbWU6IFsNCiAgICAgICAgICB7cmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fovpPlhaXmoI/nm67lkI3np7AnLCB0cmlnZ2VyOiAnYmx1cid9DQogICAgICAgIF0sDQogICAgICAgIHBpbnlpbjogWw0KICAgICAgICAgIHtyZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+i+k+WFpeagj+ebruaLvOmfsyjlhajmi7wpJywgdHJpZ2dlcjogJ2JsdXInfQ0KICAgICAgICBdLA0KICAgICAgICBjb2RlOiBbDQogICAgICAgICAge3JlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36L6T5YWl5qCP55uu5ou86Z+zKOeugOaLvCknLCB0cmlnZ2VyOiAnYmx1cid9DQogICAgICAgIF0sDQogICAgICAgIHNvcnQ6IFsNCiAgICAgICAgICB7cmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fovpPlhaXmjpLluo/lj7cnLCB0cmlnZ2VyOiAnYmx1cid9DQogICAgICAgIF0NCiAgICAgIH0sDQogICAgICB1cGREaXI6ICdpdGVtY2F0ZScsDQogICAgfQ0KICB9LA0KICBjb21wdXRlZDogew0KICAgIC4uLm1hcEdldHRlcnMoWyJwZXJtaXNzaW9uIl0pLA0KICB9LA0KICBtb3VudGVkKCkgew0KICAgIHRoaXMucXVlcnkoKTsNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIC8qIOafpeivoiAqLw0KICAgIHF1ZXJ5KCkgew0KICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsNCiAgICAgIHRoaXMuJGh0dHAuZ2V0KCcvaXRlbWNhdGUvaW5kZXgnLCB7cGFyYW1zOiB0aGlzLndoZXJlfSkudGhlbihyZXMgPT4gew0KICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsNCiAgICAgICAgaWYgKHJlcy5kYXRhLmNvZGUgPT09IDApIHsNCiAgICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLiR1dGlsLnRvVHJlZURhdGEocmVzLmRhdGEuZGF0YSwgJ2lkJywgJ3BpZCcpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLmRhdGEubXNnIHx8ICfojrflj5bmlbDmja7lpLHotKUnKTsNCiAgICAgICAgfQ0KICAgICAgfSkuY2F0Y2goZSA9PiB7DQogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOw0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGUubWVzc2FnZSk7DQogICAgICB9KTsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIOW8guatpeWKoOi9veaVsOaNrg0KICAgICAqLw0KICAgIGxvYWQodHJlZSwgdHJlZU5vZGUsIHJlc29sdmUpIHsNCiAgICAgIHRoaXMud2hlcmVbJ3BpZCddID0gdHJlZS5pZDsNCiAgICAgIHRoaXMuJGh0dHAuZ2V0KCcvaXRlbWNhdGUvaW5kZXgnLCB7cGFyYW1zOiB0aGlzLndoZXJlfSkudGhlbihyZXMgPT4gew0KICAgICAgICBpZiAocmVzLmRhdGEuY29kZSA9PT0gMCkgew0KICAgICAgICAgIHRoaXMuJHV0aWwuZWFjaFRyZWVEYXRhKHRoaXMuZGF0YSwgKGl0ZW0pID0+IHsNCiAgICAgICAgICAgIGlmIChpdGVtLmlkID09PSB0cmVlLmlkKSB7DQogICAgICAgICAgICAgIGl0ZW0uY2hpbGRyZW49cmVzLmRhdGEuZGF0YQ0KICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgICAgcmVzb2x2ZShyZXMuZGF0YS5kYXRhKQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLmRhdGEubXNnKTsNCiAgICAgICAgfQ0KICAgICAgfSkuY2F0Y2goZSA9PiB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoZS5tZXNzYWdlKTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgLyog5pi+56S65re75YqgICovDQogICAgYWRkKHJvdykgew0KICAgICAgdGhpcy5mb3JtID0ge3NvcnQ6IDAsIHBpZDogcm93ID8gcm93LmlkIDogbnVsbH07DQogICAgICB0aGlzLnNob3dFZGl0ID0gdHJ1ZTsNCiAgICB9LA0KICAgIC8qIOaYvuekuue8lui+kSAqLw0KICAgIGVkaXQocm93KSB7DQogICAgICB0aGlzLmZvcm0gPSBPYmplY3QuYXNzaWduKHt9LCByb3csIHtwaWQ6IHJvdy5waWQgfHwgbnVsbH0pOw0KICAgICAgdGhpcy5zaG93RWRpdCA9IHRydWU7DQogICAgfSwNCiAgICAvKiDkv53lrZjnvJbovpEgKi8NCiAgICBzYXZlKCkgew0KICAgICAgdGhpcy4kcmVmc1snZWRpdEZvcm0nXS52YWxpZGF0ZSgodmFsaWQpID0+IHsNCiAgICAgICAgaWYgKHZhbGlkKSB7DQogICAgICAgICAgY29uc3QgbG9hZGluZyA9IHRoaXMuJGxvYWRpbmcoe2xvY2s6IHRydWV9KTsNCiAgICAgICAgICB0aGlzLiRodHRwW3RoaXMuZm9ybS5pZCA/ICdwdXQnIDogJ3Bvc3QnXSh0aGlzLmZvcm0uaWQgPyAnL2l0ZW1jYXRlL2VkaXQnIDogJy9pdGVtY2F0ZS9hZGQnLA0KICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmZvcm0sIHtwaWQ6IHRoaXMuZm9ybS5waWQgfHwgMH0pDQogICAgICAgICAgKS50aGVuKHJlcyA9PiB7DQogICAgICAgICAgICBsb2FkaW5nLmNsb3NlKCk7DQogICAgICAgICAgICBpZiAocmVzLmRhdGEuY29kZSA9PT0gMCkgew0KICAgICAgICAgICAgICB0aGlzLnNob3dFZGl0ID0gZmFsc2U7DQogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uoe3R5cGU6ICdzdWNjZXNzJywgbWVzc2FnZTogcmVzLmRhdGEubXNnfSk7DQogICAgICAgICAgICAgIGlmICh0aGlzLmZvcm0uaWQpIHsNCiAgICAgICAgICAgICAgICAvLyDmm7TmlrDmlbDmja4NCiAgICAgICAgICAgICAgICB0aGlzLiR1dGlsLmVhY2hUcmVlRGF0YSh0aGlzLmRhdGEsIGl0ZW0gPT4gew0KICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaWQgPT09IHRoaXMuZm9ybS5pZCkgew0KICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGl0ZW0sIHRoaXMuZm9ybSk7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5KCk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLmRhdGEubXNnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KS5jYXRjaChlID0+IHsNCiAgICAgICAgICAgIGxvYWRpbmcuY2xvc2UoKTsNCiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoZS5tZXNzYWdlKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0sDQogICAgLyog5Yig6ZmkICovDQogICAgcmVtb3ZlKHJvdykgew0KICAgICAgaWYgKHJvdy5jaGlsZHJlbiAmJiByb3cuY2hpbGRyZW4ubGVuZ3RoID4gMCkgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ivt+WFiOWIoOmZpOWtkOiKgueCuScpOw0KICAgICAgY29uc3QgbG9hZGluZyA9IHRoaXMuJGxvYWRpbmcoe2xvY2s6IHRydWV9KTsNCiAgICAgIHRoaXMuJGh0dHAuZGVsZXRlKCcvaXRlbWNhdGUvZGVsZXRlLycgKyByb3cuaWQpLnRoZW4ocmVzID0+IHsNCiAgICAgICAgbG9hZGluZy5jbG9zZSgpOw0KICAgICAgICBpZiAocmVzLmRhdGEuY29kZSA9PT0gMCkgew0KICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uoe3R5cGU6ICdzdWNjZXNzJywgbWVzc2FnZTogcmVzLmRhdGEubXNnfSk7DQogICAgICAgICAgLy8g5Yig6Zmk5pWw5o2uDQogICAgICAgICAgaWYocm93LnBpZD09PTApew0KICAgICAgICAgICAgdGhpcy5kYXRhLnNwbGljZSh0aGlzLmRhdGEuZmluZEluZGV4KG5vZGU9Pm5vZGUuaWQ9PXJvdy5pZCksMSkNCiAgICAgICAgICAgIHJldHVybiA7DQogICAgICAgICAgfQ0KICAgICAgICAgIHRoaXMuJHV0aWwuZWFjaFRyZWVEYXRhKHRoaXMuZGF0YSwgaXRlbSA9PiB7DQogICAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gcm93LnBpZCkgew0KICAgICAgICAgICAgICBpdGVtLmNoaWxkcmVuLnNwbGljZShpdGVtLmNoaWxkcmVuLmZpbmRJbmRleChkID0+IGQuaWQgPT09IHJvdy5pZCksIDEpOw0KICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgfSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMuZGF0YS5tc2cpOw0KICAgICAgICB9DQogICAgICB9KS5jYXRjaChlID0+IHsNCiAgICAgICAgbG9hZGluZy5jbG9zZSgpOw0KICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGUubWVzc2FnZSk7DQogICAgICB9KTsNCiAgICB9LA0KICB9DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/system/itemcate","sourcesContent":["<template>\r\n  <div class=\"ele-body\">\r\n    <el-card shadow=\"never\">\r\n      <!-- 搜索表单 -->\r\n      <el-form :model=\"where\" label-width=\"77px\" class=\"ele-form-search\" @keyup.enter.native=\"query\"\r\n               @submit.native.prevent>\r\n        <el-row :gutter=\"15\">\r\n          <el-col :md=\"6\" :sm=\"12\">\r\n            <el-form-item label=\"栏目名称:\">\r\n              <el-input v-model=\"where.name\" placeholder=\"请输入栏目名称\" clearable/>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :md=\"9\" :sm=\"12\">\r\n            <div class=\"ele-form-actions\">\r\n              <el-button type=\"primary\" @click=\"query\" icon=\"el-icon-search\" class=\"ele-btn-icon\">查询</el-button>\r\n              <el-button @click=\"add()\" type=\"primary\" icon=\"el-icon-plus\" class=\"ele-btn-icon\" v-if=\"permission.includes('sys:itemcate:add')\">添加</el-button>\r\n            </div>\r\n          </el-col>\r\n        </el-row>\r\n      </el-form>\r\n      <!-- 数据表格 -->\r\n      <el-table ref=\"table\" :data=\"data\" v-loading=\"loading\" row-key=\"id\" default-expand-all border\r\n                height=\"calc(100vh - 215px)\" highlight-current-row  lazy\r\n    :load=\"load\"\r\n    :tree-props=\"{children: 'children', hasChildren: 'hasChildren'}\">\r\n        <el-table-column label=\"编号\" type=\"index\" width=\"60\" align=\"center\" fixed=\"left\"/>\r\n        <el-table-column label=\"栏目名称\" show-overflow-tooltip min-width=\"200\">\r\n          <template slot-scope=\"{row}\">{{ row.name }}</template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"pinyin\" label=\"拼音(全拼)\" min-width=\"150\" align=\"center\"/>\r\n        <el-table-column prop=\"code\" label=\"拼音(简拼)\" min-width=\"150\" align=\"center\"/>\r\n        <el-table-column label=\"栏目封面\" min-width=\"100\" align=\"center\">\r\n          <template slot-scope=\"{row}\">\r\n            <el-avatar shape=\"square\" :size=\"35\" :src=\"row.cover\"/>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"status\" label=\"状态\" sortable min-width=\"100\">\r\n          <template slot-scope=\"{row}\">\r\n            <ele-dot :type=\"['success', 'danger'][row.status-1]\" :ripple=\"row.status===0\"\r\n                      :text=\"['正常', '禁用'][row.status-1]\"/>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"sort\" label=\"排序\" width=\"60px\" align=\"center\"/>\r\n        <el-table-column prop=\"note\" label=\"备注\" min-width=\"200\" align=\"center\"/>\r\n        <el-table-column label=\"创建时间\" show-overflow-tooltip min-width=\"160\" align=\"center\">\r\n          <template slot-scope=\"{row}\">{{ row.createTime | toDateString }}</template>\r\n        </el-table-column>\r\n        <el-table-column label=\"操作\" width=\"190px\" align=\"center\" :resizable=\"false\"  fixed=\"right\">\r\n          <template slot-scope=\"{row}\">\r\n            <el-link @click=\"add(row)\" icon=\"el-icon-plus\" type=\"primary\" :underline=\"false\" v-if=\"permission.includes('sys:itemcate:addz')\">添加</el-link>\r\n            <el-link @click=\"edit(row)\" icon=\"el-icon-edit\" type=\"primary\" :underline=\"false\" v-if=\"permission.includes('sys:itemcate:edit')\">修改</el-link>\r\n            <el-popconfirm title=\"确定要删除此栏目吗？\" @confirm=\"remove(row)\" class=\"ele-action\">\r\n              <el-link slot=\"reference\" icon=\"el-icon-delete\" type=\"danger\" :underline=\"false\" v-if=\"permission.includes('sys:itemcate:delete')\">删除</el-link>\r\n            </el-popconfirm>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n    </el-card>\r\n    <!-- 编辑弹窗 -->\r\n    <el-dialog :title=\"form.id?'修改栏目':'添加栏目'\" :visible.sync=\"showEdit\" width=\"600px\"\r\n               @closed=\"form={}\" :destroy-on-close=\"true\" custom-class=\"ele-dialog-form\" :lock-scroll=\"false\">\r\n      <el-form :model=\"form\" ref=\"editForm\" :rules=\"rules\" label-width=\"82px\">\r\n        <el-form-item label=\"栏目封面:\">\r\n          <uploadImage :limit=\"1\" :updDir=\"updDir\" v-model=\"form.cover\"></uploadImage>\r\n        </el-form-item>\r\n        <el-row :gutter=\"15\">\r\n          <el-col :sm=\"12\">\r\n            <el-form-item label=\"栏目名称:\" prop=\"name\">\r\n              <el-input v-model=\"form.name\" placeholder=\"请输入栏目名称\" clearable/>\r\n            </el-form-item>\r\n            <el-form-item label=\"拼音全拼:\" prop=\"pinyin\">\r\n              <el-input v-model=\"form.pinyin\" placeholder=\"请输入拼音全拼\" clearable/>\r\n            </el-form-item>\r\n            <el-form-item label=\"排序号:\" prop=\"sort\">\r\n              <el-input-number v-model=\"form.sort\" controls-position=\"right\" :min=\"0\"\r\n                                placeholder=\"请输入排序号\" class=\"ele-fluid ele-text-left\"/>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :sm=\"12\">\r\n            <el-form-item label=\"状态:\">\r\n              <el-radio-group v-model=\"form.status\">\r\n                <el-radio :label=\"1\">正常</el-radio>\r\n                <el-radio :label=\"2\">禁用</el-radio>\r\n              </el-radio-group>\r\n            </el-form-item>\r\n            <el-form-item label=\"拼音简拼:\" prop=\"code\">\r\n              <el-input v-model=\"form.code\" placeholder=\"请输入拼音简拼\" clearable/>\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n        <el-form-item label=\"备注:\">\r\n          <el-input v-model=\"form.note\" placeholder=\"请输入备注\" :rows=\"3\" type=\"textarea\"/>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\">\r\n        <el-button @click=\"showEdit=false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"save\">保存</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport uploadImage from '@/components/uploadImage'\r\nimport { mapGetters } from \"vuex\";\r\nexport default {\r\n  name: \"SysItemCate\",\r\n  components: {uploadImage},\r\n  data() {\r\n    return {\r\n      loading: true,  // 加载状态\r\n      data: [],  // 列表数据\r\n      where: {},  // 搜索条件\r\n      showEdit: false,  // 是否显示表单弹窗\r\n      form: {},  // 表单数据\r\n      rules: {  // 表单验证规则\r\n        name: [\r\n          {required: true, message: '请输入栏目名称', trigger: 'blur'}\r\n        ],\r\n        pinyin: [\r\n          {required: true, message: '请输入栏目拼音(全拼)', trigger: 'blur'}\r\n        ],\r\n        code: [\r\n          {required: true, message: '请输入栏目拼音(简拼)', trigger: 'blur'}\r\n        ],\r\n        sort: [\r\n          {required: true, message: '请输入排序号', trigger: 'blur'}\r\n        ]\r\n      },\r\n      updDir: 'itemcate',\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters([\"permission\"]),\r\n  },\r\n  mounted() {\r\n    this.query();\r\n  },\r\n  methods: {\r\n    /* 查询 */\r\n    query() {\r\n      this.loading = true;\r\n      this.$http.get('/itemcate/index', {params: this.where}).then(res => {\r\n        this.loading = false;\r\n        if (res.data.code === 0) {\r\n          this.data = this.$util.toTreeData(res.data.data, 'id', 'pid');\r\n        } else {\r\n          this.$message.error(res.data.msg || '获取数据失败');\r\n        }\r\n      }).catch(e => {\r\n        this.loading = false;\r\n        this.$message.error(e.message);\r\n      });\r\n    },\r\n    /**\r\n     * 异步加载数据\r\n     */\r\n    load(tree, treeNode, resolve) {\r\n      this.where['pid'] = tree.id;\r\n      this.$http.get('/itemcate/index', {params: this.where}).then(res => {\r\n        if (res.data.code === 0) {\r\n          this.$util.eachTreeData(this.data, (item) => {\r\n            if (item.id === tree.id) {\r\n              item.children=res.data.data\r\n              return false;\r\n            }\r\n          });\r\n          resolve(res.data.data)\r\n        } else {\r\n          this.$message.error(res.data.msg);\r\n        }\r\n      }).catch(e => {\r\n        this.$message.error(e.message);\r\n      });\r\n    },\r\n    /* 显示添加 */\r\n    add(row) {\r\n      this.form = {sort: 0, pid: row ? row.id : null};\r\n      this.showEdit = true;\r\n    },\r\n    /* 显示编辑 */\r\n    edit(row) {\r\n      this.form = Object.assign({}, row, {pid: row.pid || null});\r\n      this.showEdit = true;\r\n    },\r\n    /* 保存编辑 */\r\n    save() {\r\n      this.$refs['editForm'].validate((valid) => {\r\n        if (valid) {\r\n          const loading = this.$loading({lock: true});\r\n          this.$http[this.form.id ? 'put' : 'post'](this.form.id ? '/itemcate/edit' : '/itemcate/add',\r\n              Object.assign({}, this.form, {pid: this.form.pid || 0})\r\n          ).then(res => {\r\n            loading.close();\r\n            if (res.data.code === 0) {\r\n              this.showEdit = false;\r\n              this.$message({type: 'success', message: res.data.msg});\r\n              if (this.form.id) {\r\n                // 更新数据\r\n                this.$util.eachTreeData(this.data, item => {\r\n                  if (item.id === this.form.id) {\r\n                    Object.assign(item, this.form);\r\n                    return false;\r\n                  }\r\n                });\r\n              } else {\r\n                this.query();\r\n              }\r\n            } else {\r\n              this.$message.error(res.data.msg);\r\n            }\r\n          }).catch(e => {\r\n            loading.close();\r\n            this.$message.error(e.message);\r\n          });\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n    /* 删除 */\r\n    remove(row) {\r\n      if (row.children && row.children.length > 0) return this.$message.error('请先删除子节点');\r\n      const loading = this.$loading({lock: true});\r\n      this.$http.delete('/itemcate/delete/' + row.id).then(res => {\r\n        loading.close();\r\n        if (res.data.code === 0) {\r\n          this.$message({type: 'success', message: res.data.msg});\r\n          // 删除数据\r\n          if(row.pid===0){\r\n            this.data.splice(this.data.findIndex(node=>node.id==row.id),1)\r\n            return ;\r\n          }\r\n          this.$util.eachTreeData(this.data, item => {\r\n            if (item.id === row.pid) {\r\n              item.children.splice(item.children.findIndex(d => d.id === row.id), 1);\r\n              return false;\r\n            }\r\n          });\r\n        } else {\r\n          this.$message.error(res.data.msg);\r\n        }\r\n      }).catch(e => {\r\n        loading.close();\r\n        this.$message.error(e.message);\r\n      });\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"]}]}